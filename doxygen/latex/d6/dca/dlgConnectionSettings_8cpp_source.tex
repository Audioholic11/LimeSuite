\subsection{dlg\+Connection\+Settings.\+cpp}
\label{dlgConnectionSettings_8cpp_source}\index{/home/erik/prefix/default/src/limesuite-\/dev/src/utilities\+\_\+gui/dlg\+Connection\+Settings.\+cpp@{/home/erik/prefix/default/src/limesuite-\/dev/src/utilities\+\_\+gui/dlg\+Connection\+Settings.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "dlgConnectionSettings.h"}
00002 \textcolor{preprocessor}{#include <wx/msgdlg.h>}
00003 \textcolor{preprocessor}{#include <vector>}
00004 \textcolor{preprocessor}{#include "lms7suiteEvents.h"}
00005 \textcolor{preprocessor}{#include "ConnectionHandle.h"}
00006 \textcolor{preprocessor}{#include "lms7_device.h"}
00007 \textcolor{preprocessor}{#include <iso646.h>} \textcolor{comment}{// alternative operators for visual c++: not, and, or...}
00008 \textcolor{keyword}{using namespace }std;
00009 
00010 dlgConnectionSettings::dlgConnectionSettings( wxWindow* parent )
00011     : dlgConnectionSettings_view( parent )
00012 \{
00013     lmsOpenedIndex = -1;
00014     lmsControl = \textcolor{keyword}{nullptr};
00015 \}
00016 
00017 \textcolor{keywordtype}{void} dlgConnectionSettings::SetConnectionManagers(lms_device_t** lms)
00018 \{
00019     lmsControl = lms;
00020 \}
00021 
00022 \textcolor{keywordtype}{void} dlgConnectionSettings::GetDeviceList( wxInitDialogEvent& event )
00023 \{
00024     mListLMS7ports->Clear();
00025     lms_info_str_t list[32];
00026 
00027     \textcolor{comment}{//select the currently opened index}
00028     lmsOpenedIndex = -1;
00029     \textcolor{keywordtype}{int} ret = LMS_GetDeviceList(list);
00030     \textcolor{keywordflow}{if} (ret <= 0)
00031         \textcolor{keywordflow}{return};
00032     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i<ret; ++i)
00033     \{
00034         \textcolor{keyword}{const} \textcolor{keyword}{auto} handle = lime::ConnectionHandle(list[i]);
00035         mListLMS7ports->Append(handle.ToString());
00036     \}
00037     \textcolor{keywordflow}{if} (lmsOpenedIndex >= 0 && lmsOpenedIndex < \textcolor{keywordtype}{int}(mListLMS7ports->GetCount()))
00038         mListLMS7ports->SetSelection(lmsOpenedIndex);
00039 \}
00040 
00041 \textcolor{keywordtype}{void} dlgConnectionSettings::OnConnect( wxCommandEvent& event )
00042 \{
00043     \textcolor{keyword}{auto} list = lime::LMS7_Device::GetDeviceList();
00044 
00045     \textcolor{keyword}{const} \textcolor{keywordtype}{int} selection = mListLMS7ports->GetSelection();
00046     \textcolor{keywordflow}{if}(selection != wxNOT\_FOUND && selection < list.size())
00047     \{
00048         \textcolor{keyword}{auto} dev = lime::LMS7_Device::CreateDevice(list[selection], (
      lime::LMS7_Device*)*lmsControl);
00049         \textcolor{keywordflow}{if} (!dev)
00050         \{
00051             wxMessageBox(wxString(\_(\textcolor{stringliteral}{"Failed to open device"})));
00052             \textcolor{keywordflow}{return};
00053         \}
00054         *lmsControl = dev;
00055         wxCommandEvent evt;
00056         evt.SetEventType(CONTROL\_PORT\_CONNECTED);
00057         \textcolor{keywordflow}{if}(GetParent())
00058             wxPostEvent(GetParent(), evt);
00059     \}
00060     EndModal(wxID\_OK);
00061     Destroy();
00062 \}
00063 
00064 \textcolor{keywordtype}{void} dlgConnectionSettings::OnCancel( wxCommandEvent& event )
00065 \{
00066     EndModal(wxID\_CANCEL);
00067     Destroy();
00068 \}
00069 
00070 \textcolor{keywordtype}{void} dlgConnectionSettings::OnDisconnect( wxCommandEvent& event )
00071 \{
00072     *lmsControl = \textcolor{keyword}{new} lime::LMS7_Device((lime::LMS7_Device*)*lmsControl);
00073     wxCommandEvent evt;
00074     evt.SetEventType(CONTROL\_PORT\_DISCONNECTED);
00075     \textcolor{keywordflow}{if}(GetParent())
00076         wxPostEvent(GetParent(), evt);
00077     wxInitDialogEvent tmp\_evt;
00078     GetDeviceList(tmp\_evt);
00079     mListLMS7ports->SetSelection(-1);
00080 \}
\end{DoxyCode}
