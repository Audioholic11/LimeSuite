\subsection{pnlu\+Lime\+S\+D\+R.\+cpp}
\label{pnluLimeSDR_8cpp_source}\index{/home/erik/prefix/default/src/limesuite-\/dev/src/boards\+\_\+wxgui/pnlu\+Lime\+S\+D\+R.\+cpp@{/home/erik/prefix/default/src/limesuite-\/dev/src/boards\+\_\+wxgui/pnlu\+Lime\+S\+D\+R.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "pnluLimeSDR.h"}
00002 
00003 \textcolor{preprocessor}{#include <wx/sizer.h>}
00004 \textcolor{preprocessor}{#include <wx/stattext.h>}
00005 \textcolor{preprocessor}{#include <wx/button.h>}
00006 \textcolor{preprocessor}{#include <wx/string.h>}
00007 \textcolor{preprocessor}{#include <wx/checkbox.h>}
00008 \textcolor{preprocessor}{#include <wx/msgdlg.h>}
00009 \textcolor{preprocessor}{#include "lms7suiteEvents.h"}
00010 
00011 \textcolor{preprocessor}{#include <ciso646>}
00012 
00013 
00014 \textcolor{keyword}{using namespace }std;
00015 
00016 BEGIN\_EVENT\_TABLE(pnluLimeSDR, wxPanel)
00017 END\_EVENT\_TABLE()
00018 
00019 pnluLimeSDR::pnluLimeSDR(wxWindow* parent,wxWindowID \textcolor{keywordtype}{id}, const wxPoint& pos,const wxSize& 
      size, \textcolor{keywordtype}{int} style, wxString name)
00020 \{
00021     lmsControl = \textcolor{keyword}{nullptr};
00022 
00023     Create(parent, \textcolor{keywordtype}{id}, pos, size, style, name);
00024 \textcolor{preprocessor}{#ifdef WIN32}
00025     SetBackgroundColour(wxSystemSettings::GetColour(wxSYS\_COLOUR\_BTNFACE));
00026 \textcolor{preprocessor}{#endif}
00027     wxFlexGridSizer* mainSizer = \textcolor{keyword}{new} wxFlexGridSizer(0, 2, 5, 5);
00028 
00029     SetSizer(mainSizer);
00030     
00031     mainSizer->Add(\textcolor{keyword}{new} wxStaticText(\textcolor{keyword}{this}, wxID\_ANY, \_(\textcolor{stringliteral}{"RX RF port path:"})), 1, wxALL | wxALIGN\_RIGHT | 
      wxALIGN\_CENTER\_VERTICAL, 5);
00032     wxArrayString rxChoices;
00033     rxChoices.push\_back(\_(\textcolor{stringliteral}{"LNAH"}));
00034     rxChoices.push\_back(\_(\textcolor{stringliteral}{"LNAW"}));
00035     cmbRxPath = \textcolor{keyword}{new} wxChoice(\textcolor{keyword}{this}, wxNewId(), wxDefaultPosition, wxDefaultSize, rxChoices, 1);
00036     cmbRxPath->SetSelection(0);
00037     Connect(cmbRxPath->GetId(), wxEVT\_CHOICE, wxCommandEventHandler(
      pnluLimeSDR::OnLoopbackChange), NULL, \textcolor{keyword}{this});
00038     mainSizer->Add(cmbRxPath, 1, wxEXPAND | wxALIGN\_LEFT | wxALIGN\_TOP, 5);
00039     
00040     mainSizer->Add(\textcolor{keyword}{new} wxStaticText(\textcolor{keyword}{this}, wxID\_ANY, \_(\textcolor{stringliteral}{"TX RF port path:"})), 1, wxALL | wxALIGN\_RIGHT | 
      wxALIGN\_CENTER\_VERTICAL, 5);
00041     wxArrayString txChoices;
00042     txChoices.push\_back(\_(\textcolor{stringliteral}{"Band 1"}));
00043     txChoices.push\_back(\_(\textcolor{stringliteral}{"Band 2"}));
00044     cmbTxPath = \textcolor{keyword}{new} wxChoice(\textcolor{keyword}{this}, wxNewId(), wxDefaultPosition, wxDefaultSize, txChoices, 1);
00045     cmbTxPath->SetSelection(0);
00046     Connect(cmbTxPath->GetId(), wxEVT\_CHOICE, wxCommandEventHandler(
      pnluLimeSDR::OnLoopbackChange), NULL, \textcolor{keyword}{this});
00047     mainSizer->Add(cmbTxPath, 1, wxEXPAND | wxALIGN\_LEFT | wxALIGN\_TOP, 5);
00048     mainSizer->Add(\textcolor{keyword}{new} wxStaticText(\textcolor{keyword}{this}, wxID\_ANY, \_(\textcolor{stringliteral}{"Loopback:"})), 1, wxALL | wxALIGN\_RIGHT | 
      wxALIGN\_CENTER\_VERTICAL, 5);
00049     txtLB = \textcolor{keyword}{new} wxStaticText(\textcolor{keyword}{this}, wxNewId(), \_(\textcolor{stringliteral}{"TX Band 1 -> RX LNAH"}));
00050     mainSizer->Add(txtLB, 1, wxALL | wxALIGN\_LEFT | wxALIGN\_CENTER\_VERTICAL, 5);
00051     
00052     chkTxLBSH = \textcolor{keyword}{new} wxCheckBox(\textcolor{keyword}{this}, wxNewId(), \_(\textcolor{stringliteral}{"Loopback shunt"}));
00053     Connect(chkTxLBSH->GetId(), wxEVT\_CHECKBOX, wxCommandEventHandler(
      pnluLimeSDR::OnLoopbackChange), NULL, \textcolor{keyword}{this});
00054     mainSizer->Add(chkTxLBSH, 1, wxALL | wxEXPAND | wxALIGN\_LEFT | wxALIGN\_TOP, 5);
00055     chkTxLBAT = \textcolor{keyword}{new} wxCheckBox(\textcolor{keyword}{this}, wxNewId(), \_(\textcolor{stringliteral}{"Loopback attenuator"}));
00056     Connect(chkTxLBAT->GetId(), wxEVT\_CHECKBOX, wxCommandEventHandler(
      pnluLimeSDR::OnLoopbackChange), NULL, \textcolor{keyword}{this});
00057     mainSizer->Add(chkTxLBAT, 1, wxALL | wxEXPAND | wxALIGN\_LEFT | wxALIGN\_TOP, 5);
00058 
00059     mainSizer->Fit(\textcolor{keyword}{this});
00060     mainSizer->SetSizeHints(\textcolor{keyword}{this});
00061     Layout();
00062 
00063     Bind(READ\_ALL\_VALUES, &pnluLimeSDR::OnReadAll, \textcolor{keyword}{this}, this->GetId());
00064     Bind(WRITE\_ALL\_VALUES, &pnluLimeSDR::OnLoopbackChange, \textcolor{keyword}{this}, this->GetId());
00065 \}
00066 
00067 \textcolor{keywordtype}{void} pnluLimeSDR::Initialize(lms_device_t* pControl)
00068 \{
00069     lmsControl = pControl;
00070 \}
00071 
00072 pnluLimeSDR::~pnluLimeSDR()
00073 \{
00074     chkTxLBSH->Disconnect(wxEVT\_CHECKBOX, chkTxLBSH->GetId(), wxCommandEventHandler(
      pnluLimeSDR::OnLoopbackChange), 0, \textcolor{keyword}{this});
00075     chkTxLBAT->Disconnect(wxEVT\_CHECKBOX, chkTxLBAT->GetId(), wxCommandEventHandler(
      pnluLimeSDR::OnLoopbackChange), 0, \textcolor{keyword}{this});
00076     cmbRxPath->Disconnect(wxEVT\_CHOICE, cmbRxPath->GetId(), wxCommandEventHandler(
      pnluLimeSDR::OnLoopbackChange), 0, \textcolor{keyword}{this});
00077     cmbTxPath->Disconnect(wxEVT\_CHOICE, cmbTxPath->GetId(), wxCommandEventHandler(
      pnluLimeSDR::OnLoopbackChange), 0, \textcolor{keyword}{this});
00078 \}
00079 
00080 \textcolor{keywordtype}{void} pnluLimeSDR::OnLoopbackChange(wxCommandEvent& event)
00081 \{
00082     uint16\_t addr = 0x0017;
00083     uint16\_t value = 0;
00084     value |= chkTxLBSH->GetValue() << 2;
00085     value |= chkTxLBAT->GetValue() << 1;
00086     value |= cmbRxPath->GetSelection() == 1 ? 1<<9 : 1<<8;
00087     value |= cmbTxPath->GetSelection() == 1 ? 1<<13 : 1<<12;
00088     \textcolor{keywordflow}{if}(LMS_WriteFPGAReg(lmsControl,addr, value))
00089         wxMessageBox(\_(\textcolor{stringliteral}{"Failed to write FPGA registers"}), \_(\textcolor{stringliteral}{"Error"}), wxICON\_ERROR | wxOK);
00090     txtLB->SetLabel(wxString::Format(\_(\textcolor{stringliteral}{"TX Band %c -> RX LNA%c"}), ((value>>13)&1)?\textcolor{charliteral}{'1'}:\textcolor{charliteral}{'2'},((value>>9)&1)?\textcolor{charliteral}{
      'H'}:\textcolor{charliteral}{'W'}));
00091 \}
00092 
00093 \textcolor{keywordtype}{void} pnluLimeSDR::UpdatePanel()
00094 \{
00095     uint16\_t addr = 0x0017;
00096     uint16\_t value = 0;
00097     \textcolor{keywordflow}{if}(LMS_ReadFPGAReg(lmsControl,addr, &value))
00098     \{
00099         wxMessageBox(\_(\textcolor{stringliteral}{"Failed to read FPGA registers"}), \_(\textcolor{stringliteral}{"Error"}), wxICON\_ERROR | wxOK);
00100         \textcolor{keywordflow}{return};
00101     \}
00102     chkTxLBSH->SetValue((value >> 2) & 0x1);
00103     chkTxLBAT->SetValue((value >> 1) & 0x1);
00104     cmbRxPath->SetSelection((value >> 9) & 0x1);
00105     cmbTxPath->SetSelection((value >> 13) & 0x1);
00106     txtLB->SetLabel(wxString::Format(\_(\textcolor{stringliteral}{"TX Band %c -> RX LNA%c"}), ((value>>13)&1)?\textcolor{charliteral}{'1'}:\textcolor{charliteral}{'2'},((value>>9)&1)?\textcolor{charliteral}{
      'H'}:\textcolor{charliteral}{'W'}));
00107 \}
00108 
00109 \textcolor{keywordtype}{void} pnluLimeSDR::OnReadAll(wxCommandEvent &event)
00110 \{
00111     UpdatePanel();
00112 \}
00113 
00114 \textcolor{keywordtype}{void} pnluLimeSDR::OnWriteAll(wxCommandEvent &event)
00115 \{
00116     OnLoopbackChange(event);
00117 \}
\end{DoxyCode}
