\subsection{qa\+\_\+msg\+\_\+manipulator.\+py}
\label{qa__msg__manipulator_8py_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+msg\+\_\+manipulator.\+py@{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+msg\+\_\+manipulator.\+py}}

\begin{DoxyCode}
00001 \textcolor{comment}{#!/usr/bin/env python}
00002 \textcolor{comment}{# -*- coding: utf-8 -*-}
00003 \textcolor{comment}{# }
00004 \textcolor{comment}{# Copyright 2014 Communications Engineering Lab, KIT.}
00005 \textcolor{comment}{# }
00006 \textcolor{comment}{# This is free software; you can redistribute it and/or modify}
00007 \textcolor{comment}{# it under the terms of the GNU General Public License as published by}
00008 \textcolor{comment}{# the Free Software Foundation; either version 3, or (at your option)}
00009 \textcolor{comment}{# any later version.}
00010 \textcolor{comment}{# }
00011 \textcolor{comment}{# This software is distributed in the hope that it will be useful,}
00012 \textcolor{comment}{# but WITHOUT ANY WARRANTY; without even the implied warranty of}
00013 \textcolor{comment}{# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00014 \textcolor{comment}{# GNU General Public License for more details.}
00015 \textcolor{comment}{# }
00016 \textcolor{comment}{# You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{# along with this software; see the file COPYING.  If not, write to}
00018 \textcolor{comment}{# the Free Software Foundation, Inc., 51 Franklin Street,}
00019 \textcolor{comment}{# Boston, MA 02110-1301, USA.}
00020 \textcolor{comment}{# }
00021 
00022 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} gr, gr\_unittest
00023 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} blocks
00024 \textcolor{keyword}{import} radar\_swig \textcolor{keyword}{as} radar
00025 \textcolor{keyword}{from} time \textcolor{keyword}{import} sleep
00026 \textcolor{keyword}{import} pmt
00027 
00028 \textcolor{keyword}{class }qa_msg_manipulator (gr\_unittest.TestCase):
00029 
00030     \textcolor{keyword}{def }setUp (self):
00031         self.tb = gr.top\_block ()
00032 
00033     \textcolor{keyword}{def }tearDown (self):
00034         self.tb = \textcolor{keywordtype}{None}
00035 
00036     \textcolor{keyword}{def }test_001_t (self):
00037         \textcolor{comment}{# set up pmt}
00038         in\_2 = (-1,2,-3,4,5,0)
00039         in\_3 = (1,2,3,4,5,0)
00040         in\_4 = (1,-2.1,3,-4.2,5.9,0)
00041         
00042         pmt\_1 = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{"rx\_time"}),pmt.from\_long(0))
00043         pmt\_2 = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{"test"}),pmt.init\_f32vector(6,in\_2))
00044         pmt\_3 = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{"velocity"}),pmt.init\_f32vector(6,in\_3))
00045         pmt\_4 = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{"test2"}),pmt.init\_f32vector(6,in\_4))
00046         pmt\_in = pmt.list4(pmt\_1,pmt\_2,pmt\_3,pmt\_4)
00047         
00048         \textcolor{comment}{# set up fg}
00049         symbols = (\textcolor{stringliteral}{"test"}, \textcolor{stringliteral}{"test2"})
00050         const\_add = (1, -2)
00051         const\_mult = (-5, 1)
00052         
00053         strobe = blocks.message\_strobe(pmt\_in,400);
00054         test = radar.msg\_manipulator(symbols,const\_add,const\_mult)
00055         debug = blocks.message\_debug()
00056         
00057         self.tb.msg\_connect(strobe, \textcolor{stringliteral}{"strobe"}, test, \textcolor{stringliteral}{"Msg in"})
00058         self.tb.msg\_connect(test, \textcolor{stringliteral}{"Msg out"}, debug, \textcolor{stringliteral}{"store"})
00059         self.tb.msg\_connect(test, \textcolor{stringliteral}{"Msg out"}, debug, \textcolor{stringliteral}{"print"})
00060         
00061         \textcolor{comment}{# run fg}
00062         self.tb.start()
00063         sleep(0.5)
00064         self.tb.stop()
00065         self.tb.wait()
00066         
00067         \textcolor{comment}{# check data}
00068         msg = debug.get\_message(0)
00069         out\_2 = pmt.f32vector\_elements(pmt.nth(1,pmt.nth(1,msg)))
00070         out\_3 = pmt.f32vector\_elements(pmt.nth(1,pmt.nth(2,msg)))
00071         out\_4 = pmt.f32vector\_elements(pmt.nth(1,pmt.nth(3,msg)))
00072         
00073         ref\_2 = [0]*6
00074         ref\_3 = [0]*6
00075         ref\_4 = [0]*6
00076         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(6):
00077             ref\_2[k] = (in\_2[k]+const\_add[0])*const\_mult[0]
00078             ref\_3[k] = in\_3[k]
00079             ref\_4[k] = (in\_4[k]+const\_add[1])*const\_mult[1]
00080             
00081         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(6): \textcolor{comment}{# do asserts}
00082             self.assertAlmostEqual(ref\_2[k],out\_2[k],3)
00083             self.assertAlmostEqual(ref\_3[k],out\_3[k],3)
00084             self.assertAlmostEqual(ref\_4[k],out\_4[k],3)
00085 
00086 
00087 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:
00088     gr\_unittest.run(qa\_msg\_manipulator)\textcolor{comment}{#, "qa\_msg\_manipulator.xml")}
\end{DoxyCode}
