\subsection{qa\+\_\+ofdm\+\_\+divide\+\_\+vcvc.\+py}
\label{qa__ofdm__divide__vcvc_8py_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+ofdm\+\_\+divide\+\_\+vcvc.\+py@{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+ofdm\+\_\+divide\+\_\+vcvc.\+py}}

\begin{DoxyCode}
00001 \textcolor{comment}{#!/usr/bin/env python}
00002 \textcolor{comment}{# -*- coding: utf-8 -*-}
00003 \textcolor{comment}{# }
00004 \textcolor{comment}{# Copyright 2014 Communications Engineering Lab, KIT.}
00005 \textcolor{comment}{# }
00006 \textcolor{comment}{# This is free software; you can redistribute it and/or modify}
00007 \textcolor{comment}{# it under the terms of the GNU General Public License as published by}
00008 \textcolor{comment}{# the Free Software Foundation; either version 3, or (at your option)}
00009 \textcolor{comment}{# any later version.}
00010 \textcolor{comment}{# }
00011 \textcolor{comment}{# This software is distributed in the hope that it will be useful,}
00012 \textcolor{comment}{# but WITHOUT ANY WARRANTY; without even the implied warranty of}
00013 \textcolor{comment}{# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00014 \textcolor{comment}{# GNU General Public License for more details.}
00015 \textcolor{comment}{# }
00016 \textcolor{comment}{# You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{# along with this software; see the file COPYING.  If not, write to}
00018 \textcolor{comment}{# the Free Software Foundation, Inc., 51 Franklin Street,}
00019 \textcolor{comment}{# Boston, MA 02110-1301, USA.}
00020 \textcolor{comment}{# }
00021 
00022 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} gr, gr\_unittest
00023 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} blocks
00024 \textcolor{keyword}{import} radar\_swig \textcolor{keyword}{as} radar
00025 
00026 \textcolor{keyword}{class }qa_ofdm_divide_vcvc (gr\_unittest.TestCase):
00027 
00028     \textcolor{keyword}{def }setUp (self):
00029         self.tb = gr.top\_block ()
00030 
00031     \textcolor{keyword}{def }tearDown (self):
00032         self.tb = \textcolor{keywordtype}{None}
00033 
00034     \textcolor{keyword}{def }test_001_t (self):
00035         \textcolor{comment}{#print "TEST: division without discarded carriers and sync words"}
00036         \textcolor{comment}{# set up fg}
00037         test\_len = 20
00038         vlen = 5
00039         ts\_len = test\_len/vlen/2
00040         
00041         in\_data0 = [0]*test\_len
00042         in\_data1 = [0]*test\_len
00043         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(test\_len):
00044             in\_data0[k] = complex(k-4, k+1)
00045             in\_data1[k] = complex(k+3, k-2)
00046             
00047         src0 = blocks.vector\_source\_c(in\_data0)
00048         s2v0 = blocks.stream\_to\_vector(8,vlen)
00049         s2ts0 = blocks.stream\_to\_tagged\_stream(8,vlen,ts\_len,\textcolor{stringliteral}{'packet\_len'})
00050         src1 = blocks.vector\_source\_c(in\_data1)
00051         s2v1 = blocks.stream\_to\_vector(8,vlen)
00052         s2ts1 = blocks.stream\_to\_tagged\_stream(8,vlen,ts\_len,\textcolor{stringliteral}{'packet\_len'})
00053         div = radar.ofdm\_divide\_vcvc(vlen,2*vlen,(),0)
00054         v2s = blocks.vector\_to\_stream(8,2*vlen)
00055         snk = blocks.vector\_sink\_c()
00056         
00057         self.tb.connect(src0,s2v0,s2ts0)
00058         self.tb.connect(src1,s2v1,s2ts1)
00059         self.tb.connect((s2ts0,0),(div,0))
00060         self.tb.connect((s2ts1,0),(div,1))
00061         self.tb.connect(div,v2s,snk)
00062         
00063         self.tb.run ()
00064         
00065         \textcolor{comment}{# get ref data}
00066         ref\_data = [0]*test\_len*2
00067         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(test\_len/vlen):
00068             \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} range(vlen):
00069                 ref\_data[2*vlen*k+l] = in\_data0[vlen*k+l]/in\_data1[vlen*k+l]
00070         
00071         \textcolor{comment}{# check data}
00072         out\_data =  snk.data()
00073         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(len(out\_data)):
00074             self.assertAlmostEqual(ref\_data[k], out\_data[k],4)
00075             
00076     \textcolor{keyword}{def }test_002_t (self):
00077         \textcolor{comment}{#print "TEST: discarded carriers and num sync words"}
00078         \textcolor{comment}{# set up fg}
00079         test\_len = 200
00080         vlen = 20
00081         ts\_len = test\_len/vlen
00082         
00083         discarded\_carriers = (-8,-4,-2,1,2,3,9)
00084         num\_sync\_words = 2
00085         
00086         in\_data0 = [0]*test\_len
00087         in\_data1 = [0]*test\_len
00088         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(test\_len):
00089             in\_data0[k] = complex(k-4, k+1)
00090             in\_data1[k] = complex(k+3, k-2)
00091             
00092         src0 = blocks.vector\_source\_c(in\_data0)
00093         s2v0 = blocks.stream\_to\_vector(8,vlen)
00094         s2ts0 = blocks.stream\_to\_tagged\_stream(8,vlen,ts\_len,\textcolor{stringliteral}{'packet\_len'})
00095         src1 = blocks.vector\_source\_c(in\_data1)
00096         s2v1 = blocks.stream\_to\_vector(8,vlen)
00097         s2ts1 = blocks.stream\_to\_tagged\_stream(8,vlen,ts\_len,\textcolor{stringliteral}{'packet\_len'})
00098         div = radar.ofdm\_divide\_vcvc(vlen,vlen,discarded\_carriers,num\_sync\_words)
00099         v2s = blocks.vector\_to\_stream(8,vlen)
00100         snk = blocks.vector\_sink\_c()
00101         
00102         self.tb.connect(src0,s2v0,s2ts0)
00103         self.tb.connect(src1,s2v1,s2ts1)
00104         self.tb.connect((s2ts0,0),(div,0))
00105         self.tb.connect((s2ts1,0),(div,1))
00106         self.tb.connect(div,v2s,snk)
00107         
00108         self.tb.run ()
00109         
00110         \textcolor{comment}{# get ref data}
00111         discarded\_carriers\_shift = [0]*len(discarded\_carriers)
00112         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(len(discarded\_carriers)):
00113             discarded\_carriers\_shift[k] = discarded\_carriers[k] + vlen/2
00114         ref\_data = [0]*test\_len
00115         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(test\_len/vlen):
00116             \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} range(vlen):
00117                 \textcolor{keywordflow}{if} k < num\_sync\_words: \textcolor{comment}{# do not process sync words with discarded carriers}
00118                     ref\_data[vlen*k+l] = in\_data0[vlen*k+l]/in\_data1[vlen*k+l]
00119                 \textcolor{keywordflow}{else}: \textcolor{comment}{# process discarded carriers}
00120                     \textcolor{keywordflow}{if} l \textcolor{keywordflow}{in} discarded\_carriers\_shift: \textcolor{comment}{# if actual item shall be discarded}
00121                         ref\_data[vlen*k+l] = 0
00122                     \textcolor{keywordflow}{else}: \textcolor{comment}{# if actual item shall NOT be discarded}
00123                         ref\_data[vlen*k+l] = in\_data0[vlen*k+l]/in\_data1[vlen*k+l]
00124         
00125         \textcolor{comment}{# check data}
00126         \textcolor{comment}{#print "REF"}
00127         \textcolor{comment}{#print ref\_data}
00128         out\_data =  snk.data()
00129         \textcolor{comment}{#print "DATA"}
00130         \textcolor{comment}{#print out\_data}
00131         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(len(out\_data)):
00132             self.assertAlmostEqual(ref\_data[k], out\_data[k],4)
00133 
00134 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:
00135     gr\_unittest.run(qa\_ofdm\_divide\_vcvc)\textcolor{comment}{#, "qa\_ofdm\_divide\_vcvc.xml")}
\end{DoxyCode}
