\subsection{split\+\_\+fsk\+\_\+cc\+\_\+impl.\+cc}
\label{split__fsk__cc__impl_8cc_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/lib/split\+\_\+fsk\+\_\+cc\+\_\+impl.\+cc@{/home/erik/prefix/default/src/gr-\/radar-\/dev/lib/split\+\_\+fsk\+\_\+cc\+\_\+impl.\+cc}}

\begin{DoxyCode}
00001 \textcolor{comment}{/* -*- c++ -*- */}
00002 \textcolor{comment}{/* }
00003 \textcolor{comment}{ * Copyright 2014 Communications Engineering Lab, KIT.}
00004 \textcolor{comment}{ * }
00005 \textcolor{comment}{ * This is free software; you can redistribute it and/or modify}
00006 \textcolor{comment}{ * it under the terms of the GNU General Public License as published by}
00007 \textcolor{comment}{ * the Free Software Foundation; either version 3, or (at your option)}
00008 \textcolor{comment}{ * any later version.}
00009 \textcolor{comment}{ * }
00010 \textcolor{comment}{ * This software is distributed in the hope that it will be useful,}
00011 \textcolor{comment}{ * but WITHOUT ANY WARRANTY; without even the implied warranty of}
00012 \textcolor{comment}{ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00013 \textcolor{comment}{ * GNU General Public License for more details.}
00014 \textcolor{comment}{ * }
00015 \textcolor{comment}{ * You should have received a copy of the GNU General Public License}
00016 \textcolor{comment}{ * along with this software; see the file COPYING.  If not, write to}
00017 \textcolor{comment}{ * the Free Software Foundation, Inc., 51 Franklin Street,}
00018 \textcolor{comment}{ * Boston, MA 02110-1301, USA.}
00019 \textcolor{comment}{ */}
00020  
00021 \textcolor{preprocessor}{#ifdef HAVE\_CONFIG\_H}
00022 \textcolor{preprocessor}{#include "config.h"}
00023 \textcolor{preprocessor}{#endif}
00024 
00025 \textcolor{preprocessor}{#include <gnuradio/io\_signature.h>}
00026 \textcolor{preprocessor}{#include "split_fsk_cc_impl.h"}
00027 
00028 \textcolor{keyword}{namespace }gr \{
00029   \textcolor{keyword}{namespace }radar \{
00030 
00031     split_fsk_cc::sptr
00032     split_fsk_cc::make(\textcolor{keywordtype}{int} samp_per_freq, \textcolor{keywordtype}{int} samp\_discard, \textcolor{keyword}{const} std::string& len\_key)
00033     \{
00034       \textcolor{keywordflow}{return} gnuradio::get\_initial\_sptr
00035         (\textcolor{keyword}{new} split_fsk_cc_impl(samp\_per\_freq, samp\_discard, len\_key));
00036     \}
00037 
00038     \textcolor{comment}{/*}
00039 \textcolor{comment}{     * The private constructor}
00040 \textcolor{comment}{     */}
00041     split_fsk_cc_impl::split_fsk_cc_impl(\textcolor{keywordtype}{int} samp_per_freq, \textcolor{keywordtype}{int} samp\_discard, \textcolor{keyword}{const} 
      std::string& len\_key)
00042       : gr::tagged\_stream\_block(\textcolor{stringliteral}{"split\_fsk\_cc"},
00043               gr::io\_signature::make(1, 1, sizeof(gr\_complex)),
00044               gr::io\_signature::make(2, 2, sizeof(gr\_complex)), len\_key)
00045     \{
00046         d_samp_per_freq = samp_per_freq;
00047         d_samp_discard = samp\_discard;
00048         
00049         \textcolor{keywordflow}{if}(d_samp_per_freq<=d_samp_discard) \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"samp\_per\_freq is smaller or equal
       than samp\_discard"});
00050         
00051         set\_tag\_propagation\_policy(TPP\_DONT); \textcolor{comment}{// does not apply on stream tags!}
00052     \}
00053 
00054     \textcolor{comment}{/*}
00055 \textcolor{comment}{     * Our virtual destructor.}
00056 \textcolor{comment}{     */}
00057     split_fsk_cc_impl::~split_fsk_cc_impl()
00058     \{
00059     \}
00060 
00061     \textcolor{keywordtype}{int}
00062     split_fsk_cc_impl::calculate_output_stream_length(\textcolor{keyword}{const} gr\_vector\_int &ninput\_items)
00063     \{
00064       \textcolor{keywordtype}{int} noutput\_items = ninput\_items[0]/2; \textcolor{comment}{// max is half of ninput\_items}
00065       \textcolor{keywordflow}{return} noutput\_items ;
00066     \}
00067 
00068     \textcolor{keywordtype}{int}
00069     split_fsk_cc_impl::work (\textcolor{keywordtype}{int} noutput\_items,
00070                        gr\_vector\_int &ninput\_items,
00071                        gr\_vector\_const\_void\_star &input\_items,
00072                        gr\_vector\_void\_star &output\_items)
00073     \{
00074         \textcolor{keyword}{const} gr\_complex *in = (\textcolor{keyword}{const} gr\_complex *) input\_items[0];
00075         gr\_complex *out0 = (gr\_complex *) output\_items[0];
00076         gr\_complex *out1 = (gr\_complex *) output\_items[1];
00077         
00078         \textcolor{comment}{// get all tags, reset offset and push to outputs}
00079         get\_tags\_in\_range(d_tags,0,nitems\_read(0),nitems\_read(0)+1);
00080         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} k=0; k<d_tags.size(); k++)\{
00081             add\_item\_tag(0,nitems\_written(0),d_tags[k].key,d_tags[k].value,
      d_tags[k].srcid);
00082             add\_item\_tag(1,nitems\_written(1),d_tags[k].key,d_tags[k].value,
      d_tags[k].srcid);
00083         \}
00084         
00085         \textcolor{comment}{// Resize packet len and set noutput\_items}
00086         d_nblocks = ninput\_items[0]/2/d_samp_per_freq;
00087         noutput\_items = d_nblocks*(d_samp_per_freq-d_samp_discard);
00088         update\_length\_tags(noutput\_items,2); \textcolor{comment}{// update length tag}
00089         
00090         \textcolor{comment}{// Push input\_items to outputs}
00091         \textcolor{keywordtype}{int} k=0;
00092         \textcolor{keywordflow}{while}(k<ninput\_items[0])\{
00093             \textcolor{comment}{// first freq}
00094             k+=d_samp_discard;
00095             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} l=0; l<d_samp_per_freq-d_samp_discard; l++) *out0++ = in[k+l];
00096             k+=d_samp_per_freq-d_samp_discard;
00097             \textcolor{comment}{// second freq}
00098             k+=d_samp_discard;
00099             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} l=0; l<d_samp_per_freq-d_samp_discard; l++) *out1++ = in[k+l];
00100             k+=d_samp_per_freq-d_samp_discard;
00101         \}
00102 
00103         \textcolor{comment}{// Tell runtime system how many output items we produced.}
00104         \textcolor{keywordflow}{return} noutput\_items;
00105     \}
00106 
00107   \} \textcolor{comment}{/* namespace radar */}
00108 \} \textcolor{comment}{/* namespace gr */}
00109 
\end{DoxyCode}
