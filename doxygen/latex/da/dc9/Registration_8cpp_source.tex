\subsection{Registration.\+cpp}
\label{Registration_8cpp_source}\index{/home/erik/prefix/default/src/limesuite-\/dev/\+Soapy\+L\+M\+S7/\+Registration.\+cpp@{/home/erik/prefix/default/src/limesuite-\/dev/\+Soapy\+L\+M\+S7/\+Registration.\+cpp}}

\begin{DoxyCode}
00001 
00007 \textcolor{preprocessor}{#include "SoapyLMS7.h"}
00008 \textcolor{preprocessor}{#include <SoapySDR/Registry.hpp>}
00009 \textcolor{preprocessor}{#include <SoapySDR/Logger.hpp>}
00010 \textcolor{preprocessor}{#include "Logger.h"}
00011 
00012 \textcolor{keyword}{using namespace }lime;
00013 
00014 \textcolor{keyword}{static} \textcolor{keywordtype}{void} limeSuiteLogHandler(\textcolor{keyword}{const} lime::LogLevel level, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *message)
00015 \{
00016     \textcolor{keywordflow}{switch}(level)
00017     \{
00018     \textcolor{keywordflow}{case} lime::LOG_LEVEL_CRITICAL: SoapySDR::log(SOAPY\_SDR\_CRITICAL, message); \textcolor{keywordflow}{return};
00019     \textcolor{keywordflow}{case} lime::LOG_LEVEL_ERROR: SoapySDR::log(SOAPY\_SDR\_ERROR, message); \textcolor{keywordflow}{return};
00020     \textcolor{keywordflow}{case} lime::LOG_LEVEL_WARNING: SoapySDR::log(SOAPY\_SDR\_WARNING, message); \textcolor{keywordflow}{return};
00021     \textcolor{keywordflow}{case} lime::LOG_LEVEL_INFO: SoapySDR::log(SOAPY\_SDR\_INFO, message); \textcolor{keywordflow}{return};
00022     \textcolor{keywordflow}{case} lime::LOG_LEVEL_DEBUG: SoapySDR::log(SOAPY\_SDR\_DEBUG, message); \textcolor{keywordflow}{return};
00023     \}
00024 \}
00025 
00026 \textcolor{keyword}{static} ConnectionHandle argsToHandle(\textcolor{keyword}{const} SoapySDR::Kwargs &args)
00027 \{
00028     ConnectionHandle handle;
00029 
00030     \textcolor{comment}{//load handle with key/value provided options}
00031     \textcolor{keywordflow}{if} (args.count(\textcolor{stringliteral}{"module"}) != 0) handle.module = args.at(\textcolor{stringliteral}{"module"});
00032     \textcolor{keywordflow}{if} (args.count(\textcolor{stringliteral}{"media"}) != 0) handle.media = args.at(\textcolor{stringliteral}{"media"});
00033     \textcolor{keywordflow}{if} (args.count(\textcolor{stringliteral}{"name"}) != 0) handle.name = args.at(\textcolor{stringliteral}{"name"});
00034     \textcolor{keywordflow}{if} (args.count(\textcolor{stringliteral}{"addr"}) != 0) handle.addr = args.at(\textcolor{stringliteral}{"addr"});
00035     \textcolor{keywordflow}{if} (args.count(\textcolor{stringliteral}{"serial"}) != 0) handle.serial = args.at(\textcolor{stringliteral}{"serial"});
00036     \textcolor{keywordflow}{if} (args.count(\textcolor{stringliteral}{"index"}) != 0) handle.index = std::stoi(args.at(\textcolor{stringliteral}{"index"}));
00037 
00038     \textcolor{keywordflow}{return} handle;
00039 \}
00040 
00041 \textcolor{keyword}{static} SoapySDR::Kwargs handleToArgs(\textcolor{keyword}{const} ConnectionHandle &handle)
00042 \{
00043     SoapySDR::Kwargs args;
00044 
00045     \textcolor{comment}{//convert the handle into key/value pairs}
00046     \textcolor{keywordflow}{if} (not handle.module.empty()) args[\textcolor{stringliteral}{"module"}] = handle.module;
00047     if (not handle.media.empty()) args[\textcolor{stringliteral}{"media"}] = handle.media;
00048     if (not handle.name.empty()) args[\textcolor{stringliteral}{"name"}] = handle.name;
00049     if (not handle.addr.empty()) args[\textcolor{stringliteral}{"addr"}] = handle.addr;
00050     if (not handle.serial.empty()) args[\textcolor{stringliteral}{"serial"}] = handle.serial;
00051     if (handle.index != -1) args[\textcolor{stringliteral}{"index"}] = std::to\_string(handle.index);
00052 
00053     \textcolor{comment}{//label connection for drop-downs and lists}
00054     args[\textcolor{stringliteral}{"label"}] = handle.ToString();
00055 
00056     \textcolor{keywordflow}{return} args;
00057 \}
00058 
00059 \textcolor{keyword}{static} SoapySDR::KwargsList findIConnection(\textcolor{keyword}{const} SoapySDR::Kwargs &matchArgs)
00060 \{
00061     lime::registerLogHandler(&limeSuiteLogHandler);
00062     SoapySDR::KwargsList results;
00063     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} &handle : ConnectionRegistry::findConnections(argsToHandle(matchArgs)))
00064     \{
00065         results.push\_back(handleToArgs(handle));
00066     \}
00067     \textcolor{keywordflow}{return} results;
00068 \}
00069 
00070 \textcolor{keyword}{static} SoapySDR::Device *makeIConnection(\textcolor{keyword}{const} SoapySDR::Kwargs &args)
00071 \{
00072     lime::registerLogHandler(&limeSuiteLogHandler);
00073     \textcolor{keywordflow}{return} \textcolor{keyword}{new} SoapyLMS7(argsToHandle(args), args);
00074 \}
00075 
00076 \textcolor{keyword}{static} SoapySDR::Registry registerIConnection(\textcolor{stringliteral}{"lime"}, &findIConnection, &
      makeIConnection, SOAPY\_SDR\_ABI\_VERSION);
\end{DoxyCode}
