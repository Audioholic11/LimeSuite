\subsection{qtgui\+\_\+time\+\_\+plot\+\_\+impl.\+cc}
\label{qtgui__time__plot__impl_8cc_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/lib/qtgui\+\_\+time\+\_\+plot\+\_\+impl.\+cc@{/home/erik/prefix/default/src/gr-\/radar-\/dev/lib/qtgui\+\_\+time\+\_\+plot\+\_\+impl.\+cc}}

\begin{DoxyCode}
00001 \textcolor{comment}{/* -*- c++ -*- */}
00002 \textcolor{comment}{/* }
00003 \textcolor{comment}{ * Copyright 2014 Communications Engineering Lab, KIT.}
00004 \textcolor{comment}{ * }
00005 \textcolor{comment}{ * This is free software; you can redistribute it and/or modify}
00006 \textcolor{comment}{ * it under the terms of the GNU General Public License as published by}
00007 \textcolor{comment}{ * the Free Software Foundation; either version 3, or (at your option)}
00008 \textcolor{comment}{ * any later version.}
00009 \textcolor{comment}{ * }
00010 \textcolor{comment}{ * This software is distributed in the hope that it will be useful,}
00011 \textcolor{comment}{ * but WITHOUT ANY WARRANTY; without even the implied warranty of}
00012 \textcolor{comment}{ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00013 \textcolor{comment}{ * GNU General Public License for more details.}
00014 \textcolor{comment}{ * }
00015 \textcolor{comment}{ * You should have received a copy of the GNU General Public License}
00016 \textcolor{comment}{ * along with this software; see the file COPYING.  If not, write to}
00017 \textcolor{comment}{ * the Free Software Foundation, Inc., 51 Franklin Street,}
00018 \textcolor{comment}{ * Boston, MA 02110-1301, USA.}
00019 \textcolor{comment}{ */}
00020 
00021 \textcolor{preprocessor}{#ifdef HAVE\_CONFIG\_H}
00022 \textcolor{preprocessor}{#include "config.h"}
00023 \textcolor{preprocessor}{#endif}
00024 
00025 \textcolor{preprocessor}{#include <gnuradio/io\_signature.h>}
00026 \textcolor{preprocessor}{#include "qtgui_time_plot_impl.h"}
00027 
00028 \textcolor{keyword}{namespace }gr \{
00029   \textcolor{keyword}{namespace }radar \{
00030 
00031     qtgui_time_plot::sptr
00032     qtgui_time_plot::make(\textcolor{keywordtype}{int} interval, std::string label\_y, std::vector<float> axis\_y, \textcolor{keywordtype}{float} range\_time, 
      std::string label)
00033     \{
00034       \textcolor{keywordflow}{return} gnuradio::get\_initial\_sptr
00035         (\textcolor{keyword}{new} qtgui_time_plot_impl(interval, label\_y, axis\_y, range\_time, label));
00036     \}
00037 
00038     \textcolor{comment}{/*}
00039 \textcolor{comment}{     * The private constructor}
00040 \textcolor{comment}{     */}
00041     qtgui_time_plot_impl::qtgui_time_plot_impl(\textcolor{keywordtype}{int} interval, std::string label\_y, std::vector<float> axis\_y
      , \textcolor{keywordtype}{float} range\_time, std::string label)
00042       : gr::block(\textcolor{stringliteral}{"qtgui\_time\_plot"},
00043               gr::io\_signature::make(0,0,0),
00044               gr::io\_signature::make(0,0,0))
00045     \{
00046         d_interval = interval;
00047         d_label_y = label\_y;
00048         d_axis_y = axis\_y;
00049         d_range_time = range\_time;
00050         d_y_read = \textcolor{keyword}{false};
00051         d_label = label;
00052         
00053         \textcolor{comment}{// Register input message port}
00054         d_port_id_in = pmt::mp(\textcolor{stringliteral}{"Msg in"});
00055         message\_port\_register\_in(d_port_id_in);
00056         set\_msg\_handler(d_port_id_in, boost::bind(&
      qtgui_time_plot_impl::handle_msg, \textcolor{keyword}{this}, \_1));
00057         
00058         \textcolor{comment}{// Setup GUI}
00059         run_gui();
00060     \}
00061 
00062     \textcolor{comment}{/*}
00063 \textcolor{comment}{     * Our virtual destructor.}
00064 \textcolor{comment}{     */}
00065     qtgui_time_plot_impl::~qtgui_time_plot_impl()
00066     \{
00067     \}
00068     
00069     \textcolor{keywordtype}{void}
00070     qtgui_time_plot_impl::handle_msg(pmt::pmt\_t msg)
00071     \{
00072         \textcolor{keywordtype}{size\_t} size\_msg;
00073         d_y.clear();
00074         
00075         size\_msg = pmt::length(msg);
00076         pmt::pmt\_t msg\_part;
00077         \textcolor{keywordtype}{bool} item\_found\_y;
00078         \textcolor{comment}{// Go through msg and search for key symbol}
00079         item\_found\_y = \textcolor{keyword}{false};
00080         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} k=0; k<size\_msg; k++)\{
00081             msg\_part = pmt::nth(k,msg);
00082             \textcolor{keywordflow}{if}(pmt::symbol\_to\_string(pmt::nth(0,msg\_part))==d_label_y.c\_str())\{
00083                 d_y = pmt::f32vector\_elements(pmt::nth(1,msg\_part));
00084                 item\_found\_y = \textcolor{keyword}{true};
00085                 d_y_read = \textcolor{keyword}{false};
00086             \}
00087         \}
00088         \textcolor{comment}{// Error handling}
00089         \textcolor{keywordflow}{if}(not(item\_found\_y))\{
00090             \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Identifier (symbol) not found"});
00091         \}
00092     \}
00093     
00094     \textcolor{keywordtype}{void}
00095     qtgui_time_plot_impl::run_gui()\{
00096         \textcolor{comment}{// Set QT window}
00097         \textcolor{keywordflow}{if}(qApp != NULL) \{
00098             d_qApplication = qApp;
00099         \}
00100         \textcolor{keywordflow}{else} \{
00101             d_argc = 1;
00102             d_argv = \textcolor{keyword}{new} char;
00103             d_argv[0] = \textcolor{charliteral}{'\(\backslash\)0'};
00104             d_qApplication = \textcolor{keyword}{new} QApplication(d_argc, &d_argv);
00105         \}
00106         
00107         \textcolor{comment}{// Set QWT plot widget}
00108         d_main_gui = \textcolor{keyword}{new} time_plot(d_interval, d_label_y, d_axis_y, d_range_time, &
      d_y, &d_y_read, d_label);
00109         d_main_gui->show();
00110     \}
00111 
00112   \} \textcolor{comment}{/* namespace radar */}
00113 \} \textcolor{comment}{/* namespace gr */}
00114 
\end{DoxyCode}
