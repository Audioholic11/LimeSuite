\subsection{qa\+\_\+signal\+\_\+generator\+\_\+fmcw\+\_\+c.\+py}
\label{qa__signal__generator__fmcw__c_8py_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+signal\+\_\+generator\+\_\+fmcw\+\_\+c.\+py@{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+signal\+\_\+generator\+\_\+fmcw\+\_\+c.\+py}}

\begin{DoxyCode}
00001 \textcolor{comment}{#!/usr/bin/env python}
00002 \textcolor{comment}{# -*- coding: utf-8 -*-}
00003 \textcolor{comment}{# }
00004 \textcolor{comment}{# Copyright 2014 Communications Engineering Lab, KIT.}
00005 \textcolor{comment}{# }
00006 \textcolor{comment}{# This is free software; you can redistribute it and/or modify}
00007 \textcolor{comment}{# it under the terms of the GNU General Public License as published by}
00008 \textcolor{comment}{# the Free Software Foundation; either version 3, or (at your option)}
00009 \textcolor{comment}{# any later version.}
00010 \textcolor{comment}{# }
00011 \textcolor{comment}{# This software is distributed in the hope that it will be useful,}
00012 \textcolor{comment}{# but WITHOUT ANY WARRANTY; without even the implied warranty of}
00013 \textcolor{comment}{# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00014 \textcolor{comment}{# GNU General Public License for more details.}
00015 \textcolor{comment}{# }
00016 \textcolor{comment}{# You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{# along with this software; see the file COPYING.  If not, write to}
00018 \textcolor{comment}{# the Free Software Foundation, Inc., 51 Franklin Street,}
00019 \textcolor{comment}{# Boston, MA 02110-1301, USA.}
00020 \textcolor{comment}{# }
00021 
00022 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} gr, gr\_unittest
00023 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} blocks
00024 \textcolor{keyword}{import} radar\_swig \textcolor{keyword}{as} radar
00025 \textcolor{keyword}{import} numpy \textcolor{keyword}{as} np
00026 
00027 \textcolor{keyword}{class }qa_signal_generator_fmcw_c (gr\_unittest.TestCase):
00028 
00029     \textcolor{keyword}{def }setUp (self):
00030         self.tb = gr.top\_block ()
00031 
00032     \textcolor{keyword}{def }tearDown (self):
00033         self.tb = \textcolor{keywordtype}{None}
00034 
00035     \textcolor{keyword}{def }test_001_t (self):
00036         \textcolor{comment}{# set up fg}
00037         test\_len = 1000
00038         
00039         samp\_rate = 32000
00040         samp\_up = 100
00041         samp\_down = 50
00042         samp\_cw = 75
00043         freq\_cw = 500
00044         freq\_sweep = 1000
00045         amplitude = 1
00046         
00047         test = radar.signal\_generator\_fmcw\_c(samp\_rate,samp\_up,samp\_down,samp\_cw,freq\_cw,freq\_sweep,
      amplitude)
00048         head = blocks.head(8,test\_len)
00049         sink = blocks.vector\_sink\_c()
00050         
00051         self.tb.connect(test,head,sink)
00052         self.tb.run ()
00053         
00054         \textcolor{comment}{# create waveform and ref\_data}
00055         packet\_len = samp\_cw+samp\_up+samp\_down
00056         waveform = [0]*packet\_len
00057         ref\_data = [0]*test\_len
00058         phase = 0
00059         
00060         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(samp\_cw): \textcolor{comment}{# create waveform}
00061             waveform[k] = freq\_cw
00062         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(samp\_up):
00063             waveform[samp\_cw+k] = freq\_cw+freq\_sweep*k/samp\_up
00064         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(samp\_down):
00065             waveform[samp\_cw+samp\_up+k] = freq\_cw+freq\_sweep-freq\_sweep*k/samp\_down
00066         
00067         counter = 0
00068         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(test\_len): \textcolor{comment}{# integrate phase for iq signal}
00069             \textcolor{keywordflow}{if} counter%packet\_len==0:
00070                 counter = 0
00071             ref\_data[k] = amplitude*np.exp(1j*phase)
00072             phase = phase + 2*np.pi*waveform[counter]/samp\_rate
00073             counter = counter+1
00074         
00075         \textcolor{comment}{# check data}
00076         out\_data = sink.data()
00077         self.assertEqual(len(out\_data),test\_len) \textcolor{comment}{# check size of out\_data}
00078         self.assertComplexTuplesAlmostEqual(ref\_data,out\_data,4) \textcolor{comment}{# check out\_data with ref\_data}
00079 
00080 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:
00081     gr\_unittest.run(qa\_signal\_generator\_fmcw\_c,)\textcolor{comment}{# "qa\_signal\_generator\_fmcw\_c.xml")}
\end{DoxyCode}
