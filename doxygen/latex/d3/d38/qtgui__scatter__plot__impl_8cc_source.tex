\subsection{qtgui\+\_\+scatter\+\_\+plot\+\_\+impl.\+cc}
\label{qtgui__scatter__plot__impl_8cc_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/lib/qtgui\+\_\+scatter\+\_\+plot\+\_\+impl.\+cc@{/home/erik/prefix/default/src/gr-\/radar-\/dev/lib/qtgui\+\_\+scatter\+\_\+plot\+\_\+impl.\+cc}}

\begin{DoxyCode}
00001 \textcolor{comment}{/* -*- c++ -*- */}
00002 \textcolor{comment}{/* }
00003 \textcolor{comment}{ * Copyright 2014 Communications Engineering Lab, KIT.}
00004 \textcolor{comment}{ * }
00005 \textcolor{comment}{ * This is free software; you can redistribute it and/or modify}
00006 \textcolor{comment}{ * it under the terms of the GNU General Public License as published by}
00007 \textcolor{comment}{ * the Free Software Foundation; either version 3, or (at your option)}
00008 \textcolor{comment}{ * any later version.}
00009 \textcolor{comment}{ * }
00010 \textcolor{comment}{ * This software is distributed in the hope that it will be useful,}
00011 \textcolor{comment}{ * but WITHOUT ANY WARRANTY; without even the implied warranty of}
00012 \textcolor{comment}{ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00013 \textcolor{comment}{ * GNU General Public License for more details.}
00014 \textcolor{comment}{ * }
00015 \textcolor{comment}{ * You should have received a copy of the GNU General Public License}
00016 \textcolor{comment}{ * along with this software; see the file COPYING.  If not, write to}
00017 \textcolor{comment}{ * the Free Software Foundation, Inc., 51 Franklin Street,}
00018 \textcolor{comment}{ * Boston, MA 02110-1301, USA.}
00019 \textcolor{comment}{ */}
00020 
00021 \textcolor{preprocessor}{#ifdef HAVE\_CONFIG\_H}
00022 \textcolor{preprocessor}{#include "config.h"}
00023 \textcolor{preprocessor}{#endif}
00024 
00025 \textcolor{preprocessor}{#include <gnuradio/io\_signature.h>}
00026 \textcolor{preprocessor}{#include "qtgui_scatter_plot_impl.h"}
00027 
00028 \textcolor{keyword}{namespace }gr \{
00029   \textcolor{keyword}{namespace }radar \{
00030 
00031     qtgui_scatter_plot::sptr
00032     qtgui_scatter_plot::make(\textcolor{keywordtype}{int} interval, std::string label\_x, std::string label\_y, std::vector<float> 
      axis\_x, std::vector<float> axis\_y, std::string label)
00033     \{
00034       \textcolor{keywordflow}{return} gnuradio::get\_initial\_sptr
00035         (\textcolor{keyword}{new} qtgui_scatter_plot_impl(interval, label\_x, label\_y, axis\_x, axis\_y, label));
00036     \}
00037 
00038     \textcolor{comment}{/*}
00039 \textcolor{comment}{     * The private constructor}
00040 \textcolor{comment}{     */}
00041     qtgui_scatter_plot_impl::qtgui_scatter_plot_impl(\textcolor{keywordtype}{int} interval, std::string label\_x, 
      std::string label\_y, std::vector<float> axis\_x, std::vector<float> axis\_y, 
      std::string label)
00042       : gr::block(\textcolor{stringliteral}{"qtgui\_scatter\_plot"},
00043               gr::io\_signature::make(0,0,0),
00044               gr::io\_signature::make(0,0,0))
00045     \{
00046         d_interval = interval;
00047         d_axis_x = axis\_x;
00048         d_axis_y = axis\_y;
00049         d_label_x = label\_x;
00050         d_label_y = label\_y;
00051         d_xy_read = \textcolor{keyword}{false};
00052         d_label = label;
00053         
00054         \textcolor{comment}{// Register input message port}
00055         d_port_id_in = pmt::mp(\textcolor{stringliteral}{"Msg in"});
00056         message\_port\_register\_in(d_port_id_in);
00057         set\_msg\_handler(d_port_id_in, boost::bind(&
      qtgui_scatter_plot_impl::handle_msg, \textcolor{keyword}{this}, \_1));
00058         
00059         \textcolor{comment}{// Setup GUI}
00060         run_gui();
00061     \}
00062 
00063     \textcolor{comment}{/*}
00064 \textcolor{comment}{     * Our virtual destructor.}
00065 \textcolor{comment}{     */}
00066     qtgui_scatter_plot_impl::~qtgui_scatter_plot_impl()
00067     \{
00068     \}
00069     
00070     \textcolor{keywordtype}{void}
00071     qtgui_scatter_plot_impl::handle_msg(pmt::pmt\_t msg)
00072     \{
00073         \textcolor{keywordtype}{size\_t} size\_msg;
00074         d_x.clear();
00075         d_y.clear();
00076         
00077         size\_msg = pmt::length(msg);
00078         pmt::pmt\_t msg\_part;
00079         \textcolor{keywordtype}{bool} item\_found\_x, item\_found\_y;
00080         \textcolor{comment}{// Go through msg and search for key symbols "range" and "velocity" (or other keys!) and get data}
00081         item\_found\_x = \textcolor{keyword}{false};
00082         item\_found\_y = \textcolor{keyword}{false};
00083         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} k=0; k<size\_msg; k++)\{
00084             msg\_part = pmt::nth(k,msg);
00085             \textcolor{keywordflow}{if}(pmt::symbol\_to\_string(pmt::nth(0,msg\_part))==d_label_x.c\_str())\{
00086                 d_x = pmt::f32vector\_elements(pmt::nth(1,msg\_part));
00087                 item\_found\_x = \textcolor{keyword}{true};
00088                 d_xy_read = \textcolor{keyword}{false};
00089             \}
00090             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(pmt::symbol\_to\_string(pmt::nth(0,msg\_part))==d_label_y.c\_str())\{
00091                 d_y = pmt::f32vector\_elements(pmt::nth(1,msg\_part));
00092                 item\_found\_y = \textcolor{keyword}{true};
00093                 d_xy_read = \textcolor{keyword}{false};
00094             \}
00095         \}
00096         \textcolor{comment}{// Fill zeros in vector if only one label is found}
00097         \textcolor{keywordflow}{if}(not(item\_found\_x)&&item\_found\_y)\{
00098             d_x.resize(d_y.size());
00099         \}
00100         \textcolor{keywordflow}{if}(item\_found\_x&&not(item\_found\_y))\{
00101             d_y.resize(d_x.size());
00102         \}
00103         \textcolor{keywordflow}{if}(not(item\_found\_x)&&not(item\_found\_y))\{
00104             \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"All identifiers (symbols) not found"}); \textcolor{comment}{// throw exception if no label
       found}
00105         \}
00106     \}
00107     
00108     \textcolor{keywordtype}{void}
00109     qtgui_scatter_plot_impl::run_gui()\{
00110         \textcolor{comment}{// Set QT window}
00111         \textcolor{keywordflow}{if}(qApp != NULL) \{
00112             d_qApplication = qApp;
00113         \}
00114         \textcolor{keywordflow}{else} \{
00115             d_argc = 1;
00116             d_argv = \textcolor{keyword}{new} char;
00117             d_argv[0] = \textcolor{charliteral}{'\(\backslash\)0'};
00118             d_qApplication = \textcolor{keyword}{new} QApplication(d_argc, &d_argv);
00119         \}
00120         
00121         \textcolor{comment}{// Set QWT plot widget}
00122         d_main_gui = \textcolor{keyword}{new} scatter_plot(d_interval, d_axis_x, d_axis_y, &d_x, &d_y, 
      d_label_x, d_label_y, &d_xy_read, d_label);
00123         d_main_gui->show();
00124     \}
00125 
00126   \} \textcolor{comment}{/* namespace radar */}
00127 \} \textcolor{comment}{/* namespace gr */}
00128 
\end{DoxyCode}
