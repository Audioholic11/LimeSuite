\subsection{qa\+\_\+find\+\_\+max\+\_\+peak\+\_\+c.\+py}
\label{qa__find__max__peak__c_8py_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+find\+\_\+max\+\_\+peak\+\_\+c.\+py@{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+find\+\_\+max\+\_\+peak\+\_\+c.\+py}}

\begin{DoxyCode}
00001 \textcolor{comment}{#!/usr/bin/env python}
00002 \textcolor{comment}{# -*- coding: utf-8 -*-}
00003 \textcolor{comment}{# }
00004 \textcolor{comment}{# Copyright 2014 Communications Engineering Lab, KIT.}
00005 \textcolor{comment}{# }
00006 \textcolor{comment}{# This is free software; you can redistribute it and/or modify}
00007 \textcolor{comment}{# it under the terms of the GNU General Public License as published by}
00008 \textcolor{comment}{# the Free Software Foundation; either version 3, or (at your option)}
00009 \textcolor{comment}{# any later version.}
00010 \textcolor{comment}{# }
00011 \textcolor{comment}{# This software is distributed in the hope that it will be useful,}
00012 \textcolor{comment}{# but WITHOUT ANY WARRANTY; without even the implied warranty of}
00013 \textcolor{comment}{# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00014 \textcolor{comment}{# GNU General Public License for more details.}
00015 \textcolor{comment}{# }
00016 \textcolor{comment}{# You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{# along with this software; see the file COPYING.  If not, write to}
00018 \textcolor{comment}{# the Free Software Foundation, Inc., 51 Franklin Street,}
00019 \textcolor{comment}{# Boston, MA 02110-1301, USA.}
00020 \textcolor{comment}{# }
00021 
00022 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} gr, gr\_unittest
00023 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} blocks,analog
00024 \textcolor{keyword}{import} radar\_swig \textcolor{keyword}{as} radar
00025 \textcolor{keyword}{from} time \textcolor{keyword}{import} sleep
00026 \textcolor{keyword}{import} pmt
00027 
00028 \textcolor{keyword}{class }qa_find_max_peak_c (gr\_unittest.TestCase):
00029 
00030     \textcolor{keyword}{def }setUp (self):
00031         self.tb = gr.top\_block ()
00032 
00033     \textcolor{keyword}{def }tearDown (self):
00034         self.tb = \textcolor{keywordtype}{None}
00035 
00036     \textcolor{keyword}{def }test_001_t (self):
00037         \textcolor{comment}{# test on positive frequencies}
00038         \textcolor{comment}{# set up fg}
00039         test\_len = 1000
00040         samp\_rate = 2000
00041         freq = 200
00042         ampl = 1
00043         packet\_len = test\_len
00044         threshold = -100
00045         samp\_protect = 2
00046         
00047         src = analog.sig\_source\_c(samp\_rate, analog.GR\_COS\_WAVE, freq, ampl)
00048         head = blocks.head(8,test\_len)
00049         s2ts = blocks.stream\_to\_tagged\_stream(8,1,packet\_len,\textcolor{stringliteral}{"packet\_len"})
00050         fft = radar.ts\_fft\_cc(packet\_len)
00051         peak = radar.find\_max\_peak\_c(samp\_rate, threshold, samp\_protect, (0,0), \textcolor{keyword}{False})
00052         debug = blocks.message\_debug()
00053         
00054         self.tb.connect(src,head,s2ts,fft,peak)
00055         self.tb.msg\_connect(peak,\textcolor{stringliteral}{"Msg out"},debug,\textcolor{stringliteral}{"store"})
00056         \textcolor{comment}{#self.tb.msg\_connect(peak,"Msg out",debug,"print")}
00057         self.tb.start()
00058         sleep(0.5)
00059         self.tb.stop()
00060         self.tb.wait()
00061         
00062         \textcolor{comment}{# check frequency in os\_cfar message with given one}
00063         msg = debug.get\_message(0)
00064         self.assertAlmostEqual(freq,pmt.f32vector\_ref(pmt.nth(1,pmt.nth(1,msg)),0),8)
00065         
00066     \textcolor{keyword}{def }test_002_t (self):
00067         \textcolor{comment}{# test on negative frequencies}
00068         \textcolor{comment}{# set up fg}
00069         test\_len = 1000
00070         samp\_rate = 2000
00071         freq = -200
00072         ampl = 1
00073         packet\_len = test\_len
00074         threshold = -100
00075         samp\_protect = 2
00076         
00077         src = analog.sig\_source\_c(samp\_rate, analog.GR\_COS\_WAVE, freq, ampl)
00078         head = blocks.head(8,test\_len)
00079         s2ts = blocks.stream\_to\_tagged\_stream(8,1,packet\_len,\textcolor{stringliteral}{"packet\_len"})
00080         fft = radar.ts\_fft\_cc(packet\_len)
00081         peak = radar.find\_max\_peak\_c(samp\_rate, threshold, samp\_protect, (0,0), \textcolor{keyword}{False})
00082         debug = blocks.message\_debug()
00083         
00084         self.tb.connect(src,head,s2ts,fft,peak)
00085         self.tb.msg\_connect(peak,\textcolor{stringliteral}{"Msg out"},debug,\textcolor{stringliteral}{"store"})
00086         \textcolor{comment}{#self.tb.msg\_connect(peak,"Msg out",debug,"print")}
00087         self.tb.start()
00088         sleep(0.5)
00089         self.tb.stop()
00090         self.tb.wait()
00091         
00092         \textcolor{comment}{# check frequency in os\_cfar message with given one}
00093         msg = debug.get\_message(0)
00094         self.assertAlmostEqual(freq,pmt.f32vector\_ref(pmt.nth(1,pmt.nth(1,msg)),0),8)
00095         
00096     \textcolor{keyword}{def }test_003_t (self):
00097         \textcolor{comment}{# test cut frequency negative freq}
00098         \textcolor{comment}{# set up fg}
00099         test\_len = 1000
00100         samp\_rate = 2000
00101         freq1 = -200
00102         freq2 = -205
00103         ampl = 1
00104         packet\_len = test\_len
00105         threshold = -100
00106         samp\_protect = 2
00107         
00108         src1 = analog.sig\_source\_c(samp\_rate, analog.GR\_COS\_WAVE, freq1, ampl*0.2)
00109         src2 = analog.sig\_source\_c(samp\_rate, analog.GR\_COS\_WAVE, freq2, ampl)
00110         add = blocks.add\_cc();
00111         head = blocks.head(8,test\_len)
00112         s2ts = blocks.stream\_to\_tagged\_stream(8,1,packet\_len,\textcolor{stringliteral}{"packet\_len"})
00113         fft = radar.ts\_fft\_cc(packet\_len)
00114         peak = radar.find\_max\_peak\_c(samp\_rate, threshold, samp\_protect, (-200,200), \textcolor{keyword}{True})
00115         debug = blocks.message\_debug()
00116         
00117         self.tb.connect((src1,0), (add,0))
00118         self.tb.connect((src2,0), (add,1))
00119         self.tb.connect(add,head,s2ts,fft,peak)
00120         self.tb.msg\_connect(peak,\textcolor{stringliteral}{"Msg out"},debug,\textcolor{stringliteral}{"store"})
00121         \textcolor{comment}{#self.tb.msg\_connect(peak,"Msg out",debug,"print")}
00122         self.tb.start()
00123         sleep(0.5)
00124         self.tb.stop()
00125         self.tb.wait()
00126         
00127         \textcolor{comment}{# check frequency in os\_cfar message with given one}
00128         msg = debug.get\_message(0)
00129         self.assertAlmostEqual(freq1,pmt.f32vector\_ref(pmt.nth(1,pmt.nth(1,msg)),0),8)
00130         
00131     \textcolor{keyword}{def }test_004t (self):
00132         \textcolor{comment}{# test cut frequency positive freq}
00133         \textcolor{comment}{# set up fg}
00134         test\_len = 1000
00135         samp\_rate = 2000
00136         freq1 = -200
00137         freq2 = 205
00138         ampl = 1
00139         packet\_len = test\_len
00140         threshold = -100
00141         samp\_protect = 2
00142         
00143         src1 = analog.sig\_source\_c(samp\_rate, analog.GR\_COS\_WAVE, freq1, ampl*0.2)
00144         src2 = analog.sig\_source\_c(samp\_rate, analog.GR\_COS\_WAVE, freq2, ampl)
00145         add = blocks.add\_cc();
00146         head = blocks.head(8,test\_len)
00147         s2ts = blocks.stream\_to\_tagged\_stream(8,1,packet\_len,\textcolor{stringliteral}{"packet\_len"})
00148         fft = radar.ts\_fft\_cc(packet\_len)
00149         peak = radar.find\_max\_peak\_c(samp\_rate, threshold, samp\_protect, (-200,200), \textcolor{keyword}{True})
00150         debug = blocks.message\_debug()
00151         
00152         self.tb.connect((src1,0), (add,0))
00153         self.tb.connect((src2,0), (add,1))
00154         self.tb.connect(add,head,s2ts,fft,peak)
00155         self.tb.msg\_connect(peak,\textcolor{stringliteral}{"Msg out"},debug,\textcolor{stringliteral}{"store"})
00156         \textcolor{comment}{#self.tb.msg\_connect(peak,"Msg out",debug,"print")}
00157         self.tb.start()
00158         sleep(0.5)
00159         self.tb.stop()
00160         self.tb.wait()
00161         
00162         \textcolor{comment}{# check frequency in os\_cfar message with given one}
00163         msg = debug.get\_message(0)
00164         self.assertAlmostEqual(freq1,pmt.f32vector\_ref(pmt.nth(1,pmt.nth(1,msg)),0),8)
00165 
00166 
00167 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:
00168     gr\_unittest.run(qa\_find\_max\_peak\_c)\textcolor{comment}{#, "qa\_find\_max\_peak\_c.xml")}
\end{DoxyCode}
