\subsection{qtgui\+\_\+spectrogram\+\_\+plot\+\_\+impl.\+cc}
\label{qtgui__spectrogram__plot__impl_8cc_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/lib/qtgui\+\_\+spectrogram\+\_\+plot\+\_\+impl.\+cc@{/home/erik/prefix/default/src/gr-\/radar-\/dev/lib/qtgui\+\_\+spectrogram\+\_\+plot\+\_\+impl.\+cc}}

\begin{DoxyCode}
00001 \textcolor{comment}{/* -*- c++ -*- */}
00002 \textcolor{comment}{/* }
00003 \textcolor{comment}{ * Copyright 2014 Communications Engineering Lab, KIT.}
00004 \textcolor{comment}{ * }
00005 \textcolor{comment}{ * This is free software; you can redistribute it and/or modify}
00006 \textcolor{comment}{ * it under the terms of the GNU General Public License as published by}
00007 \textcolor{comment}{ * the Free Software Foundation; either version 3, or (at your option)}
00008 \textcolor{comment}{ * any later version.}
00009 \textcolor{comment}{ * }
00010 \textcolor{comment}{ * This software is distributed in the hope that it will be useful,}
00011 \textcolor{comment}{ * but WITHOUT ANY WARRANTY; without even the implied warranty of}
00012 \textcolor{comment}{ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00013 \textcolor{comment}{ * GNU General Public License for more details.}
00014 \textcolor{comment}{ * }
00015 \textcolor{comment}{ * You should have received a copy of the GNU General Public License}
00016 \textcolor{comment}{ * along with this software; see the file COPYING.  If not, write to}
00017 \textcolor{comment}{ * the Free Software Foundation, Inc., 51 Franklin Street,}
00018 \textcolor{comment}{ * Boston, MA 02110-1301, USA.}
00019 \textcolor{comment}{ */}
00020 
00021 \textcolor{preprocessor}{#ifdef HAVE\_CONFIG\_H}
00022 \textcolor{preprocessor}{#include "config.h"}
00023 \textcolor{preprocessor}{#endif}
00024 
00025 \textcolor{preprocessor}{#include <gnuradio/io\_signature.h>}
00026 \textcolor{preprocessor}{#include "qtgui_spectrogram_plot_impl.h"}
00027 
00028 \textcolor{keyword}{namespace }gr \{
00029   \textcolor{keyword}{namespace }radar \{
00030 
00031     qtgui_spectrogram_plot::sptr
00032     qtgui_spectrogram_plot::make(\textcolor{keywordtype}{int} vlen, \textcolor{keywordtype}{int} interval, std::string xlabel, 
      std::string ylabel, std::string label, std::vector<float> axis\_x, std::vector<float> axis\_y, 
      std::vector<float> axis\_z, \textcolor{keywordtype}{bool} autoscale\_z, std::string len\_key)
00033     \{
00034       \textcolor{keywordflow}{return} gnuradio::get\_initial\_sptr
00035         (\textcolor{keyword}{new} qtgui_spectrogram_plot_impl(vlen, interval, xlabel, ylabel, label, axis\_x, axis\_y, axis\_z, 
      autoscale\_z, len\_key));
00036     \}
00037 
00038     \textcolor{comment}{/*}
00039 \textcolor{comment}{     * The private constructor}
00040 \textcolor{comment}{     */}
00041     qtgui_spectrogram_plot_impl::qtgui_spectrogram_plot_impl(\textcolor{keywordtype}{int} vlen, \textcolor{keywordtype}{int} interval, 
      std::string xlabel, std::string ylabel, std::string label, std::vector<float> axis\_x, std::vector<float> 
      axis\_y, std::vector<float> axis\_z, \textcolor{keywordtype}{bool} autoscale\_z, std::string len\_key)
00042       : gr::tagged\_stream\_block(\textcolor{stringliteral}{"qtgui\_spectrogram\_plot"},
00043               gr::io\_signature::make(1, 1, sizeof(float)*vlen),
00044               gr::io\_signature::make(0, 0, 0), len\_key)
00045     \{
00046         d_vlen = vlen;
00047         d_interval = interval;
00048         d_xlabel = xlabel;
00049         d_ylabel = ylabel;
00050         d_label = label;
00051         d_axis_x = axis\_x;
00052         d_axis_y = axis\_y;
00053         d_axis_z = axis\_z;
00054         d_autoscale_z = autoscale\_z;
00055         d_buffer.resize(0);
00056         
00057         \textcolor{comment}{// Setup GUI}
00058         run_gui();
00059     \}
00060 
00061     \textcolor{comment}{/*}
00062 \textcolor{comment}{     * Our virtual destructor.}
00063 \textcolor{comment}{     */}
00064     qtgui_spectrogram_plot_impl::~qtgui_spectrogram_plot_impl()
00065     \{
00066     \}
00067     
00068     \textcolor{keywordtype}{void}
00069     qtgui_spectrogram_plot_impl::run_gui()\{
00070         \textcolor{comment}{// Set QT window}
00071         \textcolor{keywordflow}{if}(qApp != NULL) \{
00072             d_qApplication = qApp;
00073         \}
00074         \textcolor{keywordflow}{else} \{
00075             d_argc = 1;
00076             d_argv = \textcolor{keyword}{new} char;
00077             d_argv[0] = \textcolor{charliteral}{'\(\backslash\)0'};
00078             d_qApplication = \textcolor{keyword}{new} QApplication(d_argc, &d_argv);
00079         \}
00080         
00081         \textcolor{comment}{// Set QWT plot widget}
00082         d_main_gui = \textcolor{keyword}{new} spectrogram_plot(d_interval, d_vlen, &d_buffer, 
      d_xlabel, d_ylabel, d_label, d_axis_x, d_axis_y, d_axis_z, d_autoscale_z);
00083         d_main_gui->show();
00084     \}
00085 
00086     \textcolor{keywordtype}{int}
00087     qtgui_spectrogram_plot_impl::calculate_output_stream_length(\textcolor{keyword}{const} gr\_vector\_int &ninput\_items)
00088     \{
00089       \textcolor{keywordtype}{int} noutput\_items = 0;
00090       \textcolor{keywordflow}{return} noutput\_items ;
00091     \}
00092 
00093     \textcolor{keywordtype}{int}
00094     qtgui_spectrogram_plot_impl::work (\textcolor{keywordtype}{int} noutput\_items,
00095                        gr\_vector\_int &ninput\_items,
00096                        gr\_vector\_const\_void\_star &input\_items,
00097                        gr\_vector\_void\_star &output\_items)
00098     \{
00099         \textcolor{keyword}{const} \textcolor{keywordtype}{float} *in = (\textcolor{keyword}{const} \textcolor{keywordtype}{float} *) input\_items[0];
00100 
00101         \textcolor{comment}{// Copy data to shared buffer with GUI}
00102         \textcolor{keywordflow}{if}(d_buffer.size()!=ninput\_items[0]*d_vlen)\{ \textcolor{comment}{// resize buffer if needed}
00103             d_buffer.resize(ninput\_items[0]*d_vlen);
00104         \}
00105         memcpy(&d_buffer[0], in, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})*ninput\_items[0]*d_vlen);
00106 
00107         \textcolor{comment}{// Tell runtime system how many output items we produced.}
00108         \textcolor{keywordflow}{return} 0;
00109     \}
00110 
00111   \} \textcolor{comment}{/* namespace radar */}
00112 \} \textcolor{comment}{/* namespace gr */}
00113 
\end{DoxyCode}
