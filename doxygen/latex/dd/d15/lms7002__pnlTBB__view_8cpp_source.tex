\subsection{lms7002\+\_\+pnl\+T\+B\+B\+\_\+view.\+cpp}
\label{lms7002__pnlTBB__view_8cpp_source}\index{/home/erik/prefix/default/src/limesuite-\/dev/src/lms7002\+\_\+wxgui/lms7002\+\_\+pnl\+T\+B\+B\+\_\+view.\+cpp@{/home/erik/prefix/default/src/limesuite-\/dev/src/lms7002\+\_\+wxgui/lms7002\+\_\+pnl\+T\+B\+B\+\_\+view.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "lms7002_pnlTBB_view.h"}
00002 \textcolor{preprocessor}{#include <map>}
00003 \textcolor{preprocessor}{#include "lms7002_gui_utilities.h"}
00004 \textcolor{preprocessor}{#include "numericSlider.h"}
00005 \textcolor{preprocessor}{#include "lms7suiteEvents.h"}
00006 \textcolor{preprocessor}{#include "lms7_device.h"}
00007 \textcolor{preprocessor}{#include "lms7suiteAppFrame.h"}
00008 
00009 \textcolor{keyword}{using namespace }lime;
00010 
00011 lms7002_pnlTBB_view::lms7002_pnlTBB_view( wxWindow* parent )
00012 :
00013 pnlTBB_view( parent )
00014 \{
00015 
00016 \}
00017 
00018 lms7002_pnlTBB_view::lms7002_pnlTBB_view( wxWindow* parent, wxWindowID \textcolor{keywordtype}{id}, \textcolor{keyword}{const} wxPoint& pos, \textcolor{keyword}{const} wxSize
      & size, \textcolor{keywordtype}{long} style )
00019     : pnlTBB_view(parent, id, pos, size, style), lmsControl(nullptr)
00020 \{
00021     wndId2Enum[chkBYPLADDER_TBB] = LMS7param(BYPLADDER_TBB);
00022     wndId2Enum[cmbCCAL_LPFLAD_TBB] = LMS7param(CCAL_LPFLAD_TBB);
00023     wndId2Enum[cmbCG_IAMP_TBB] = LMS7param(CG_IAMP_TBB);
00024     wndId2Enum[chkEN_G_TBB] = LMS7param(EN_G_TBB);
00025     wndId2Enum[cmbICT_IAMP_FRP_TBB] = LMS7param(ICT_IAMP_FRP_TBB);
00026     wndId2Enum[cmbICT_IAMP_GG_FRP_TBB] = LMS7param(ICT_IAMP_GG_FRP_TBB);
00027     wndId2Enum[cmbICT_LPFH_F_TBB] = LMS7param(ICT_LPFH_F_TBB);
00028     wndId2Enum[cmbICT_LPFLAD_F_TBB] = LMS7param(ICT_LPFLAD_F_TBB);
00029     wndId2Enum[cmbICT_LPFLAD_PT_TBB] = LMS7param(ICT_LPFLAD_PT_TBB);
00030     wndId2Enum[cmbICT_LPFS5_F_TBB] = LMS7param(ICT_LPFS5_F_TBB);
00031     wndId2Enum[cmbICT_LPFS5_PT_TBB] = LMS7param(ICT_LPFS5_PT_TBB);
00032     wndId2Enum[cmbICT_LPF_H_PT_TBB] = LMS7param(ICT_LPF_H_PT_TBB);
00033     wndId2Enum[cmbLOOPB_TBB] = LMS7param(LOOPB_TBB);
00034     wndId2Enum[chkPD_LPFH_TBB] = LMS7param(PD_LPFH_TBB);
00035     wndId2Enum[chkPD_LPFIAMP_TBB] = LMS7param(PD_LPFIAMP_TBB);
00036     wndId2Enum[chkPD_LPFLAD_TBB] = LMS7param(PD_LPFLAD_TBB);
00037     wndId2Enum[chkPD_LPFS5_TBB] = LMS7param(PD_LPFS5_TBB);
00038     wndId2Enum[cmbRCAL_LPFH_TBB] = LMS7param(RCAL_LPFH_TBB);
00039     wndId2Enum[cmbRCAL_LPFLAD_TBB] = LMS7param(RCAL_LPFLAD_TBB);
00040     wndId2Enum[cmbRCAL_LPFS5_TBB] = LMS7param(RCAL_LPFS5_TBB);
00041     wndId2Enum[cmbTSTIN_TBB] = LMS7param(TSTIN_TBB);
00042     wndId2Enum[chkEN_DIR_TBB] = LMS7param(EN_DIR_TBB);
00043     wndId2Enum[chkR5_LPF_BYP_TBB] = LMS7param(R5_LPF_BYP_TBB);
00044 
00045     wxArrayString temp;
00046     temp.clear();
00047     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i<32; ++i)
00048     \{
00049         temp.push\_back(wxString::Format(\_(\textcolor{stringliteral}{"%i"}), i));
00050     \}
00051     cmbICT_LPFH_F_TBB->Set(temp);
00052     cmbICT_LPFLAD_F_TBB->Set(temp);
00053     cmbICT_LPFLAD_PT_TBB->Set(temp);
00054     cmbICT_LPFS5_F_TBB->Set(temp);
00055     cmbICT_LPFS5_PT_TBB->Set(temp);
00056     cmbICT_LPF_H_PT_TBB->Set(temp);
00057 
00058     temp.clear();
00059     temp.push\_back(\_(\textcolor{stringliteral}{"Disabled"}));
00060     temp.push\_back(\_(\textcolor{stringliteral}{"DAC current output"}));
00061     temp.push\_back(\_(\textcolor{stringliteral}{"LPFLAD ladder output"}));
00062     temp.push\_back(\_(\textcolor{stringliteral}{"TBB output"}));
00063     temp.push\_back(\_(\textcolor{stringliteral}{"DAC current output (IQ swap)"}));
00064     temp.push\_back(\_(\textcolor{stringliteral}{"LPFLAD ladder output (IQ swap)"}));
00065     temp.push\_back(\_(\textcolor{stringliteral}{"TBB output (IQ swap)"}));
00066     cmbLOOPB_TBB->Set(temp);
00067 
00068     temp.clear();
00069     temp.push\_back(\textcolor{stringliteral}{"Disabled"});
00070     temp.push\_back(\textcolor{stringliteral}{"to Highband filter"});
00071     temp.push\_back(\textcolor{stringliteral}{"to Lowband filter"});
00072     temp.push\_back(\textcolor{stringliteral}{"to current amplifier"});
00073     cmbTSTIN_TBB->Set(temp);
00074 
00075     LMS7002_WXGUI::UpdateTooltips(wndId2Enum, \textcolor{keyword}{true});
00076 \}
00077 
00078 \textcolor{keywordtype}{void} lms7002_pnlTBB_view::Initialize(lms_device_t* pControl)
00079 \{
00080     lmsControl = pControl;
00081     assert(lmsControl != \textcolor{keyword}{nullptr});
00082     uint16\_t value;
00083     \textcolor{keywordflow}{if} (LMS_ReadParam(lmsControl,LMS7param(MASK),&value)!=0  || value != 0)
00084         value = 1;
00085     chkR5_LPF_BYP_TBB->Enable(value);
00086 \}
00087 
00088 \textcolor{keywordtype}{void} lms7002_pnlTBB_view::ParameterChangeHandler(wxSpinEvent& event)
00089 \{
00090     wxCommandEvent evt;
00091     evt.SetInt(event.GetInt());
00092     evt.SetId(event.GetId());
00093     evt.SetEventObject(event.GetEventObject());
00094     ParameterChangeHandler(evt);
00095 \}
00096 
00097 \textcolor{keywordtype}{void} lms7002_pnlTBB_view::ParameterChangeHandler(wxCommandEvent& event)
00098 \{
00099     assert(lmsControl != \textcolor{keyword}{nullptr});
00100     LMS7Parameter parameter;
00101     \textcolor{keywordflow}{try}
00102     \{
00103         parameter = wndId2Enum.at(reinterpret\_cast<wxWindow*>(event.GetEventObject()));
00104     \}
00105     \textcolor{keywordflow}{catch} (std::exception & e)
00106     \{
00107         std::cout << \textcolor{stringliteral}{"Control element(ID = "} << \textcolor{keyword}{event}.GetId() << \textcolor{stringliteral}{") don't have assigned LMS parameter."} << 
      std::endl;
00108         \textcolor{keywordflow}{return};
00109     \}
00110     LMS_WriteParam(lmsControl,parameter,event.GetInt());
00111 \}
00112 
00113 \textcolor{keywordtype}{void} lms7002_pnlTBB_view::UpdateGUI()
00114 \{
00115     LMS7002_WXGUI::UpdateControlsByMap(\textcolor{keyword}{this}, lmsControl, wndId2Enum);
00116     \textcolor{comment}{//check if B channel is enabled}
00117     uint16\_t value;
00118     LMS_ReadParam(lmsControl,LMS7param(MAC),&value);
00119     \textcolor{keywordflow}{if} (value >= 2)
00120     \{
00121         LMS_ReadParam(lmsControl,LMS7param(MIMO_SISO),&value);
00122         \textcolor{keywordflow}{if} (value != 0)
00123             wxMessageBox(\_(\textcolor{stringliteral}{"MIMO channel B is disabled"}), \_(\textcolor{stringliteral}{"Warning"}));
00124     \}
00125     LMS_ReadParam(lmsControl,LMS7param(TRX_GAIN_SRC),&value);
00126     cmbCG_IAMP_TBB->Enable(!value);
00127 \}
00128 
00129 \textcolor{keywordtype}{void} lms7002_pnlTBB_view::OnbtnTuneFilter( wxCommandEvent& event )
00130 \{
00131     \textcolor{keywordtype}{double} input1;
00132     txtFilterFrequency->GetValue().ToDouble(&input1);
00133     uint16\_t ch;
00134     LMS_ReadParam(lmsControl,LMS7param(MAC),&ch);
00135     ch = (ch == 2) ? 1 : 0;
00136     ch += 2*LMS7SuiteAppFrame::m_lmsSelection;
00137     \textcolor{keywordtype}{int} status;
00138     status = LMS_SetLPFBW(lmsControl,LMS_CH_TX,ch,input1*1e6);
00139 
00140     \textcolor{keywordflow}{if} (status != 0) \{
00141         wxMessageBox(wxString(\_(\textcolor{stringliteral}{"Tx calibration failed"})));
00142         \textcolor{keywordflow}{return};
00143     \}
00144     LMS_Synchronize(lmsControl,\textcolor{keyword}{false});
00145     UpdateGUI();
00146 \}
00147 
00148 \textcolor{keywordtype}{void} lms7002_pnlTBB_view::OnbtnTuneTxGain( wxCommandEvent& event )
00149 \{
00150     \textcolor{keywordtype}{double} input1;
00151     txtFilterFrequency->GetValue().ToDouble(&input1);
00152     uint16\_t ch;
00153     LMS_ReadParam(lmsControl,LMS7param(MAC),&ch);
00154     LMS7002M* lms = ((LMS7_Device*)lmsControl)->GetLMS();
00155     \textcolor{keywordtype}{int} status = lms->CalibrateTxGain(0, \textcolor{keyword}{nullptr});
00156 
00157     \textcolor{keywordflow}{if} (status != 0)
00158     \{
00159         wxMessageBox(wxString(\_(\textcolor{stringliteral}{"Tx gain calibration failed"})));
00160         \textcolor{keywordflow}{return};
00161     \}
00162     LMS_Synchronize(lmsControl,\textcolor{keyword}{false});
00163     UpdateGUI();
00164 \}
\end{DoxyCode}
