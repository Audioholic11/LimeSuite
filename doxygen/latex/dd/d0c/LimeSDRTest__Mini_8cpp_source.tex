\subsection{Lime\+S\+D\+R\+Test\+\_\+\+Mini.\+cpp}
\label{LimeSDRTest__Mini_8cpp_source}\index{/home/erik/prefix/default/src/limesuite-\/dev/\+Quick\+Test/\+Lime\+S\+D\+R\+Test\+\_\+\+Mini.\+cpp@{/home/erik/prefix/default/src/limesuite-\/dev/\+Quick\+Test/\+Lime\+S\+D\+R\+Test\+\_\+\+Mini.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include <chrono>}
00002 \textcolor{preprocessor}{#include "Logger.h"}
00003 \textcolor{preprocessor}{#include "LMS64CProtocol.h"}
00004 \textcolor{preprocessor}{#include "LimeSDRTest.h"}
00005 \textcolor{preprocessor}{#include <thread>}
00006 \textcolor{preprocessor}{#include "kiss_fft.h"}
00007 \textcolor{preprocessor}{#include "FPGA_Mini.h"}
00008 \textcolor{preprocessor}{#include <ctime>}
00009 
00010 \textcolor{keyword}{using namespace }lime;
00011 
00012 \textcolor{keywordtype}{int} LimeSDRTest_Mini::ClockNetworkTest()
00013 \{
00014     \textcolor{keywordtype}{int} ret = 0;
00015     UpdateStatus(LMS_TEST_INFO, \textcolor{stringliteral}{"->REF clock test"});
00016     \textcolor{keywordflow}{if} (GPIFClkTest() == -1)
00017     \{
00018         UpdateStatus(LMS_TEST_INFO, \textcolor{stringliteral}{"->REF clock test FAILED"});
00019         ret = -1;
00020     \}
00021 
00022     UpdateStatus(LMS_TEST_INFO, \textcolor{stringliteral}{"->VCTCXO test"});
00023     \textcolor{keywordflow}{if} (VCTCXOTest() == -1)
00024     \{
00025         UpdateStatus(LMS_TEST_INFO, \textcolor{stringliteral}{"  FAILED"});
00026         ret = -1;
00027     \}
00028     \textcolor{keywordflow}{return} ret;
00029 \}
00030 
00031 \textcolor{keywordtype}{int} LimeSDRTest_Mini::RFTest()
00032 \{
00033     \textcolor{keyword}{auto} testPath = [\textcolor{keyword}{this}](\textcolor{keywordtype}{float} freq, \textcolor{keywordtype}{int} rxPath)->\textcolor{keywordtype}{bool}\{
00034         \textcolor{keyword}{const} \textcolor{keywordtype}{float} tx\_offset = 5e6;
00035         \textcolor{keywordtype}{bool} passed = \textcolor{keyword}{true};
00036         \textcolor{keywordflow}{if} (device->GetLMS()->SetFrequencySX(lime::LMS7002M::Tx, freq+tx\_offset)!=0)
00037             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00038         \textcolor{keywordflow}{if} (device->GetLMS()->SetFrequencySX(lime::LMS7002M::Rx, freq)!=0)
00039             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00040         RFTestData testinfo = \{freq, freq+tx\_offset, -14, tx\_offset, 0\};
00041         device->SetPath(\textcolor{keyword}{false}, 0, rxPath);
00042         device->SetPath(\textcolor{keyword}{true}, 0, rxPath==1? 1 : 2);
00043         \textcolor{keywordflow}{if} (device->GetConnection()->WriteRegister(0x17, rxPath==1? 0x2200:0x1100) != 0)
00044             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00045         \textcolor{keywordtype}{bool} testPassed = RunTest(testinfo.peakval,testinfo.peakfreq, 0);
00046         std::string str = RFTestInfo(testinfo, testPassed);
00047         UpdateStatus(LMS_TEST_INFO, str.c\_str());
00048         \textcolor{keywordflow}{if} (testPassed == \textcolor{keyword}{false})
00049             passed = \textcolor{keyword}{false};
00050         \textcolor{keywordflow}{return} passed;
00051     \};
00052 
00053     UpdateStatus(LMS_TEST_INFO, \textcolor{stringliteral}{"->Configure LMS"});
00054     device->Init();
00055     \textcolor{keywordflow}{if} (device->SetRate(30.72e6, 0)!=0)
00056     \{
00057         UpdateStatus(LMS_TEST_FAIL, \textcolor{stringliteral}{"Failed to set sample rate"});
00058         \textcolor{keywordflow}{return} -1;
00059     \}
00060     device->SetGain(\textcolor{keyword}{false}, 0, 26);
00061     device->SetTestSignal(\textcolor{keyword}{true},0,LMS_TESTSIG_DC, 0x7000, 0x7000);
00062 
00063     UpdateStatus(LMS_TEST_INFO, \textcolor{stringliteral}{"->Run Tests (TX\_2 -> LNA\_W):"});
00064     \textcolor{keywordtype}{bool} passed = testPath(1000e6, 3);
00065     UpdateStatus(LMS_TEST_INFO, \textcolor{stringliteral}{"->Run Tests (TX\_1 -> LNA\_H):"});
00066     passed &= testPath(2100e6, 1);
00067 
00068     \textcolor{keywordflow}{return} passed ? 0 : -1;
00069 \}
\end{DoxyCode}
