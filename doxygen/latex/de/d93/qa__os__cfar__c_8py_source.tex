\subsection{qa\+\_\+os\+\_\+cfar\+\_\+c.\+py}
\label{qa__os__cfar__c_8py_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+os\+\_\+cfar\+\_\+c.\+py@{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+os\+\_\+cfar\+\_\+c.\+py}}

\begin{DoxyCode}
00001 \textcolor{comment}{#!/usr/bin/env python}
00002 \textcolor{comment}{# -*- coding: utf-8 -*-}
00003 \textcolor{comment}{# }
00004 \textcolor{comment}{# Copyright 2014 Communications Engineering Lab, KIT.}
00005 \textcolor{comment}{# }
00006 \textcolor{comment}{# This is free software; you can redistribute it and/or modify}
00007 \textcolor{comment}{# it under the terms of the GNU General Public License as published by}
00008 \textcolor{comment}{# the Free Software Foundation; either version 3, or (at your option)}
00009 \textcolor{comment}{# any later version.}
00010 \textcolor{comment}{# }
00011 \textcolor{comment}{# This software is distributed in the hope that it will be useful,}
00012 \textcolor{comment}{# but WITHOUT ANY WARRANTY; without even the implied warranty of}
00013 \textcolor{comment}{# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00014 \textcolor{comment}{# GNU General Public License for more details.}
00015 \textcolor{comment}{# }
00016 \textcolor{comment}{# You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{# along with this software; see the file COPYING.  If not, write to}
00018 \textcolor{comment}{# the Free Software Foundation, Inc., 51 Franklin Street,}
00019 \textcolor{comment}{# Boston, MA 02110-1301, USA.}
00020 \textcolor{comment}{# }
00021 
00022 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} gr, gr\_unittest
00023 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} blocks,analog
00024 \textcolor{keyword}{import} radar\_swig \textcolor{keyword}{as} radar
00025 \textcolor{keyword}{from} time \textcolor{keyword}{import} sleep
00026 \textcolor{keyword}{import} pmt
00027 
00028 \textcolor{keyword}{class }qa_os_cfar_c (gr\_unittest.TestCase):
00029 
00030     \textcolor{keyword}{def }setUp (self):
00031         self.tb = gr.top\_block ()
00032 
00033     \textcolor{keyword}{def }tearDown (self):
00034         self.tb = \textcolor{keywordtype}{None}
00035 
00036     \textcolor{keyword}{def }test_001_t (self):
00037         \textcolor{comment}{# set up fg}
00038         test\_len = 1000
00039         samp\_rate = 2000
00040         freq = 200
00041         ampl = 1
00042         packet\_len = test\_len
00043         compare\_sample = 5
00044         protect\_sample = 0
00045         rel\_threshold = 0.78
00046         mult\_threshold = 10
00047         
00048         src = analog.sig\_source\_c(samp\_rate, analog.GR\_COS\_WAVE, freq, ampl)
00049         head = blocks.head(8,test\_len)
00050         s2ts = blocks.stream\_to\_tagged\_stream(8,1,packet\_len,\textcolor{stringliteral}{"packet\_len"})
00051         fft = radar.ts\_fft\_cc(packet\_len)
00052         cfar = radar.os\_cfar\_c(samp\_rate, compare\_sample, protect\_sample, rel\_threshold, mult\_threshold)
00053         debug = blocks.message\_debug()
00054         
00055         self.tb.connect(src,head,s2ts,fft,cfar)
00056         self.tb.msg\_connect(cfar,\textcolor{stringliteral}{"Msg out"},debug,\textcolor{stringliteral}{"store"})
00057         self.tb.msg\_connect(cfar,\textcolor{stringliteral}{"Msg out"},debug,\textcolor{stringliteral}{"print"})
00058         self.tb.start()
00059         sleep(0.5)
00060         self.tb.stop()
00061         self.tb.wait()
00062         
00063         \textcolor{comment}{# check frequency in os\_cfar message with given one}
00064         msg = debug.get\_message(0)
00065         self.assertAlmostEqual(freq,pmt.f32vector\_ref(pmt.nth(1,pmt.nth(1,msg)),0),8)
00066         
00067     \textcolor{keyword}{def }test_002_t (self):
00068         \textcolor{comment}{# set up fg}
00069         test\_len = 2**15
00070         samp\_rate = 250000
00071         freq = -2000
00072         ampl = 1
00073         packet\_len = test\_len
00074         min\_output\_buffer = 2*packet\_len
00075         compare\_sample = 5
00076         protect\_sample = 0
00077         rel\_threshold = 0.78
00078         mult\_threshold = 10
00079         
00080         src = analog.sig\_source\_c(samp\_rate, analog.GR\_COS\_WAVE, freq, ampl)
00081         src.set\_min\_output\_buffer(min\_output\_buffer)
00082         head = blocks.head(8,test\_len)
00083         head.set\_min\_output\_buffer(min\_output\_buffer)
00084         s2ts = blocks.stream\_to\_tagged\_stream(8,1,packet\_len,\textcolor{stringliteral}{"packet\_len"})
00085         s2ts.set\_min\_output\_buffer(min\_output\_buffer)
00086         fft = radar.ts\_fft\_cc(packet\_len)
00087         fft.set\_min\_output\_buffer(min\_output\_buffer)
00088         cfar = radar.os\_cfar\_c(samp\_rate, compare\_sample, protect\_sample, rel\_threshold, mult\_threshold)
00089         debug = blocks.message\_debug()
00090         
00091         self.tb.connect(src,head,s2ts,fft,cfar)
00092         self.tb.msg\_connect(cfar,\textcolor{stringliteral}{"Msg out"},debug,\textcolor{stringliteral}{"store"})
00093         self.tb.msg\_connect(cfar,\textcolor{stringliteral}{"Msg out"},debug,\textcolor{stringliteral}{"print"})
00094         self.tb.start()
00095         sleep(0.5)
00096         self.tb.stop()
00097         self.tb.wait()
00098         
00099         \textcolor{comment}{# check frequency in os\_cfar message with given one}
00100         msg = debug.get\_message(0)
00101         self.assertAlmostEqual(freq/pmt.f32vector\_ref(pmt.nth(1,pmt.nth(1,msg)),0),1,2)
00102 
00103 
00104 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:
00105     gr\_unittest.run(qa\_os\_cfar\_c)\textcolor{comment}{#, "qa\_os\_cfar\_c.xml")}
\end{DoxyCode}
