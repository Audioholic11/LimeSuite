\subsection{Lime\+Util.\+cpp}
\label{LimeUtil_8cpp_source}\index{/home/erik/prefix/default/src/limesuite-\/dev/\+Lime\+Util/\+Lime\+Util.\+cpp@{/home/erik/prefix/default/src/limesuite-\/dev/\+Lime\+Util/\+Lime\+Util.\+cpp}}

\begin{DoxyCode}
00001 
00007 \textcolor{preprocessor}{#include <VersionInfo.h>}
00008 \textcolor{preprocessor}{#include <SystemResources.h>}
00009 \textcolor{preprocessor}{#include <ConnectionRegistry.h>}
00010 \textcolor{preprocessor}{#include <IConnection.h>}
00011 \textcolor{preprocessor}{#include <iostream>}
00012 \textcolor{preprocessor}{#include <cstdlib>}
00013 \textcolor{preprocessor}{#include <ciso646>}
00014 \textcolor{preprocessor}{#include <getopt.h>}
00015 \textcolor{preprocessor}{#include <fstream>}
00016 \textcolor{preprocessor}{#include "Logger.h"}
00017 \textcolor{preprocessor}{#include "LMS64CProtocol.h"}
00018 
00019 \textcolor{keyword}{using namespace }lime;
00020 
00021 \textcolor{keywordtype}{int} deviceTestTiming(\textcolor{keyword}{const} std::string &argStr);
00022 \textcolor{keywordtype}{int} deviceCalSweep(
00023     \textcolor{keyword}{const} std::string &argStr,
00024     \textcolor{keyword}{const} \textcolor{keywordtype}{double} start,
00025     \textcolor{keyword}{const} \textcolor{keywordtype}{double} stop,
00026     \textcolor{keyword}{const} \textcolor{keywordtype}{double} step,
00027     \textcolor{keyword}{const} \textcolor{keywordtype}{double} bw,
00028     \textcolor{keyword}{const} std::string &dir,
00029     \textcolor{keyword}{const} std::string &chans);
00030 
00031 \textcolor{comment}{/***********************************************************************}
00032 \textcolor{comment}{ * print help}
00033 \textcolor{comment}{ **********************************************************************/}
00034 \textcolor{keyword}{static} \textcolor{keywordtype}{int} printHelp(\textcolor{keywordtype}{void})
00035 \{
00036     std::cout << \textcolor{stringliteral}{"Usage LimeUtil [options]"} << std::endl;
00037     std::cout << \textcolor{stringliteral}{"  Options summary:"} << std::endl;
00038     std::cout << \textcolor{stringliteral}{"    --help \(\backslash\)t\(\backslash\)t\(\backslash\)t\(\backslash\)t Print this help message"} << std::endl;
00039     std::cout << \textcolor{stringliteral}{"    --info \(\backslash\)t\(\backslash\)t\(\backslash\)t\(\backslash\)t Print module information"} << std::endl;
00040     std::cout << \textcolor{stringliteral}{"    --find[=\(\backslash\)"module=foo,serial=bar\(\backslash\)"] \(\backslash\)t Discover available devices"} << std::endl;
00041     std::cout << \textcolor{stringliteral}{"    --make[=\(\backslash\)"module=foo,serial=bar\(\backslash\)"] \(\backslash\)t Create a device instance"} << std::endl;
00042     std::cout << std::endl;
00043     std::cout << \textcolor{stringliteral}{"  Advanced options:"} << std::endl;
00044     std::cout << \textcolor{stringliteral}{"    --args[=\(\backslash\)"module=foo,serial=bar\(\backslash\)"] \(\backslash\)t Arguments for the options below"} << std::endl;
00045     std::cout << \textcolor{stringliteral}{"    --update          \(\backslash\)t\(\backslash\)t\(\backslash\)t Automatic firmware sync + flash"} << std::endl;
00046     std::cout << \textcolor{stringliteral}{"    --fpga=\(\backslash\)"filename\(\backslash\)" \(\backslash\)t\(\backslash\)t\(\backslash\)t Program FPGA gateware to flash"} << std::endl;
00047     std::cout << \textcolor{stringliteral}{"    --fw=\(\backslash\)"filename\(\backslash\)"   \(\backslash\)t\(\backslash\)t\(\backslash\)t Program FX3  firmware to flash"} << std::endl;
00048     std::cout << \textcolor{stringliteral}{"    --timing          \(\backslash\)t\(\backslash\)t\(\backslash\)t Time interfaces and operations"} << std::endl;
00049     std::cout << std::endl;
00050     std::cout << \textcolor{stringliteral}{"  Calibrations sweep:"} << std::endl;
00051     std::cout << \textcolor{stringliteral}{"    --cal[=\(\backslash\)"module=foo,serial=bar\(\backslash\)"]  \(\backslash\)t Calibrate device, optional device args..."} << 
      std::endl;
00052     std::cout << \textcolor{stringliteral}{"    --start[=freqStart]                \(\backslash\)t Frequency start for the sweep(Hz)"} << std::endl
      ;
00053     std::cout << \textcolor{stringliteral}{"    --stop[=freqStop]                  \(\backslash\)t Frequency stop for the sweep(Hz)"} << std::endl;
00054     std::cout << \textcolor{stringliteral}{"    --step[=freqStep, default=1MHz]    \(\backslash\)t Frequency step for the sweep(Hz)"} << std::endl;
00055     std::cout << \textcolor{stringliteral}{"    --bw[=bandwidth, default=30MHz]    \(\backslash\)t Desired calibration bandwidth(Hz)"} << std::endl
      ;
00056     std::cout << \textcolor{stringliteral}{"    --dir[=direction, default=BOTH]    \(\backslash\)t Calibration direction, RX, TX, BOTH"} << 
      std::endl;
00057     std::cout << \textcolor{stringliteral}{"    --chans[=channels, default=ALL]    \(\backslash\)t Calibration channels, 0, 1, ALL"} << std::endl;
00058     std::cout << std::endl;
00059     \textcolor{keywordflow}{return} EXIT\_SUCCESS;
00060 \}
00061 
00062 \textcolor{comment}{/***********************************************************************}
00063 \textcolor{comment}{ * print info}
00064 \textcolor{comment}{ **********************************************************************/}
00065 \textcolor{keyword}{static} \textcolor{keywordtype}{int} printInfo(\textcolor{keywordtype}{void})
00066 \{
00067     std::cout << \textcolor{stringliteral}{"######################################################"} << std::endl;
00068     std::cout << \textcolor{stringliteral}{"## LimeSuite information summary"} << std::endl;
00069     std::cout << \textcolor{stringliteral}{"######################################################"} << std::endl;
00070     std::cout << std::endl;
00071 
00072     std::cout << \textcolor{stringliteral}{"Version information:"} << std::endl;
00073     std::cout << \textcolor{stringliteral}{"  Library version:\(\backslash\)tv"} << lime::GetLibraryVersion() << std::endl;
00074     std::cout << \textcolor{stringliteral}{"  Build timestamp:\(\backslash\)t"} << lime::GetBuildTimestamp() << std::endl;
00075     std::cout << \textcolor{stringliteral}{"  Interface version:\(\backslash\)tv"} << lime::GetAPIVersion() << std::endl;
00076     std::cout << \textcolor{stringliteral}{"  Binary interface:\(\backslash\)t"} << lime::GetABIVersion() << std::endl;
00077     std::cout << std::endl;
00078 
00079     std::cout << \textcolor{stringliteral}{"System resources:"} << std::endl;
00080     std::cout << \textcolor{stringliteral}{"  Installation root:\(\backslash\)t"} << lime::getLimeSuiteRoot() << std::endl;
00081     std::cout << \textcolor{stringliteral}{"  User home directory:\(\backslash\)t"} << lime::getHomeDirectory() << std::endl;
00082     std::cout << \textcolor{stringliteral}{"  App data directory:\(\backslash\)t"} << lime::getAppDataDirectory() << std::endl;
00083     std::cout << \textcolor{stringliteral}{"  Config directory:\(\backslash\)t"} << lime::getConfigDirectory() << std::endl;
00084     std::cout << \textcolor{stringliteral}{"  Image search paths:"} << std::endl;
00085     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} &name : lime::listImageSearchPaths()) std::cout << \textcolor{stringliteral}{"     - "} << 
      name << std::endl;
00086     std::cout << std::endl;
00087 
00088     std::cout << \textcolor{stringliteral}{"Supported connections:"} << std::endl;
00089     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} &name : ConnectionRegistry::moduleNames()) std::cout << \textcolor{stringliteral}{"   * "} << 
      name << std::endl;
00090     std::cout << std::endl;
00091     \textcolor{keywordflow}{return} EXIT\_SUCCESS;
00092 \}
00093 
00094 \textcolor{comment}{/***********************************************************************}
00095 \textcolor{comment}{ * find devices}
00096 \textcolor{comment}{ **********************************************************************/}
00097 \textcolor{keyword}{static} \textcolor{keywordtype}{int} findDevices(\textcolor{keywordtype}{void})
00098 \{
00099     std::string argStr;
00100     \textcolor{keywordflow}{if} (optarg != NULL) argStr = optarg;
00101     ConnectionHandle hint(argStr);
00102 
00103     \textcolor{keyword}{auto} handles = ConnectionRegistry::findConnections(hint);
00104     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} &handle : handles)
00105     \{
00106         std::cout << \textcolor{stringliteral}{"  * ["} << handle.serialize() << \textcolor{stringliteral}{"]"} << std::endl;
00107     \}
00108 
00109     std::cout << std::endl;
00110     \textcolor{keywordflow}{return} EXIT\_SUCCESS;
00111 \}
00112 
00113 \textcolor{comment}{/***********************************************************************}
00114 \textcolor{comment}{ * make a device}
00115 \textcolor{comment}{ **********************************************************************/}
00116 \textcolor{keyword}{static} \textcolor{keywordtype}{int} makeDevice(\textcolor{keywordtype}{void})
00117 \{
00118     std::string argStr;
00119     \textcolor{keywordflow}{if} (optarg != NULL) argStr = optarg;
00120     ConnectionHandle handle(argStr);
00121 
00122     std::cout << \textcolor{stringliteral}{"Make device "} << argStr << std::endl;
00123     \textcolor{keyword}{auto} conn = ConnectionRegistry::makeConnection(handle);
00124     \textcolor{keywordflow}{if} (conn == \textcolor{keyword}{nullptr})
00125     \{
00126         std::cout << \textcolor{stringliteral}{"No available device!"} << std::endl;
00127         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00128     \}
00129     \textcolor{keywordflow}{if} (not conn->IsOpen())
00130     \{
00131         std::cout << \textcolor{stringliteral}{"Connection not open!"} << std::endl;
00132         ConnectionRegistry::freeConnection(conn);
00133         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00134     \}
00135 
00136     \textcolor{keyword}{auto} info = conn->GetDeviceInfo();
00137     std::cout << \textcolor{stringliteral}{"  Device name: "} << info.deviceName << std::endl;
00138     std::cout << \textcolor{stringliteral}{"  Expansion name: "} << info.expansionName << std::endl;
00139     std::cout << \textcolor{stringliteral}{"  Firmware version: "} << info.firmwareVersion << std::endl;
00140     std::cout << \textcolor{stringliteral}{"  Hardware version: "} << info.hardwareVersion << std::endl;
00141     std::cout << \textcolor{stringliteral}{"  Protocol version: "} << info.protocolVersion << std::endl;
00142     std::cout << \textcolor{stringliteral}{"  Gateware version: "} << info.gatewareVersion << std::endl;
00143     std::cout << \textcolor{stringliteral}{"  Gateware revision: "} << info.gatewareRevision << std::endl;
00144     std::cout << \textcolor{stringliteral}{"  Gateware target: "} << info.gatewareTargetBoard << std::endl;
00145     std::cout << \textcolor{stringliteral}{"  Serial number: "} << std::hex << \textcolor{stringliteral}{"0x"} << info.boardSerialNumber << std::dec << std::endl
      ;
00146 
00147     std::cout << \textcolor{stringliteral}{"  Free connection... "} << std::flush;
00148     ConnectionRegistry::freeConnection(conn);
00149     std::cout << \textcolor{stringliteral}{"OK"} << std::endl;
00150     std::cout << std::endl;
00151     \textcolor{keywordflow}{return} EXIT\_SUCCESS;
00152 \}
00153 
00154 \textcolor{comment}{/***********************************************************************}
00155 \textcolor{comment}{ * Program update (sync images and flash support)}
00156 \textcolor{comment}{ **********************************************************************/}
00157 \textcolor{keyword}{static} \textcolor{keywordtype}{int} programUpdate(\textcolor{keyword}{const} std::string &argStr)
00158 \{
00159     \textcolor{keyword}{auto} handles = ConnectionRegistry::findConnections(argStr);
00160     \textcolor{keywordflow}{if}(handles.size() == 0)
00161     \{
00162         std::cout << \textcolor{stringliteral}{"No devices found"} << std::endl;
00163         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00164     \}
00165     std::cout << \textcolor{stringliteral}{"Connected to ["} << handles[0].ToString() << \textcolor{stringliteral}{"]"} << std::endl;
00166     \textcolor{keyword}{auto} conn = ConnectionRegistry::makeConnection(handles[0]);
00167 
00168     \textcolor{keyword}{auto} progCallback = [](\textcolor{keywordtype}{int} bsent, \textcolor{keywordtype}{int} btotal, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* progressMsg)
00169     \{
00170         printf(\textcolor{stringliteral}{"[%3i%%] %5i/%5i Bytes %s\(\backslash\)r"}, \textcolor{keywordtype}{int}(100.0*bsent/btotal+0.5), bsent, btotal, progressMsg);
00171         fflush(stdout);
00172         \textcolor{keywordflow}{return} 0;
00173     \};
00174 
00175     \textcolor{keyword}{auto} status = conn->ProgramUpdate(\textcolor{keyword}{true}\textcolor{comment}{/*yes download*/}, progCallback);
00176 
00177     std::cout << std::endl;
00178     \textcolor{keywordflow}{if}(status == 0)
00179     \{
00180         std::cout << \textcolor{stringliteral}{"Programming update complete!"} << std::endl;
00181     \}
00182     \textcolor{keywordflow}{else}
00183     \{
00184         std::cout << \textcolor{stringliteral}{"Programming update failed! : "} << GetLastErrorMessage() << std::endl;
00185     \}
00186 
00187     ConnectionRegistry::freeConnection(conn);
00188     \textcolor{keywordflow}{return} (status==0)?EXIT\_SUCCESS:EXIT\_FAILURE;
00189 \}
00190 
00191 \textcolor{comment}{/***********************************************************************}
00192 \textcolor{comment}{ * Program gateware}
00193 \textcolor{comment}{ **********************************************************************/}
00194 \textcolor{keyword}{static} \textcolor{keywordtype}{int} programGateware(\textcolor{keyword}{const} std::string &argStr)
00195 \{
00196     \textcolor{comment}{//load file}
00197     std::ifstream file;
00198     file.open(optarg, std::ios::in | std::ios::binary);
00199     \textcolor{keywordflow}{if}(not file.good())
00200     \{
00201         std::cout << \textcolor{stringliteral}{"File not found: "} << optarg << std::endl;
00202         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00203     \}
00204 
00205     std::streampos fileSize;
00206     file.seekg(0, std::ios::end);
00207     fileSize = file.tellg();
00208     file.seekg(0, std::ios::beg);
00209     std::vector<char> progData(fileSize, 0);
00210     file.read(progData.data(), fileSize);
00211 
00212     \textcolor{keyword}{auto} handles = ConnectionRegistry::findConnections(argStr);
00213     \textcolor{keywordflow}{if}(handles.size() == 0)
00214     \{
00215         std::cout << \textcolor{stringliteral}{"No devices found"} << std::endl;
00216         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00217     \}
00218     std::cout << \textcolor{stringliteral}{"Connected to ["} << handles[0].ToString() << \textcolor{stringliteral}{"]"} << std::endl;
00219     \textcolor{keyword}{auto} conn = ConnectionRegistry::makeConnection(handles[0]);
00220 
00221     \textcolor{keyword}{auto} progCallback = [](\textcolor{keywordtype}{int} bsent, \textcolor{keywordtype}{int} btotal, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* progressMsg)
00222     \{
00223         printf(\textcolor{stringliteral}{"[%3i%%] %5i/%5i Bytes %s\(\backslash\)r"}, \textcolor{keywordtype}{int}(100.0*bsent/btotal+0.5), bsent, btotal, progressMsg);
00224         fflush(stdout);
00225         \textcolor{keywordflow}{return} 0;
00226     \};
00227 
00228     \textcolor{keywordtype}{int} device = LMS64CProtocol::FPGA; \textcolor{comment}{//Altera FPGA}
00229     \textcolor{keywordtype}{int} progMode = 1; \textcolor{comment}{//Bitstream to FLASH}
00230     \textcolor{keyword}{auto} status = conn->ProgramWrite(progData.data(), progData.size(), progMode, 
      device, progCallback);
00231 
00232     std::cout << std::endl;
00233     \textcolor{keywordflow}{if}(status == 0)
00234     \{
00235         \textcolor{comment}{//boot from FLASH}
00236         status = conn->ProgramWrite(\textcolor{keyword}{nullptr}, 0, 2, device, \textcolor{keyword}{nullptr});
00237         \textcolor{keywordflow}{if}(status == 0)
00238             std::cout << \textcolor{stringliteral}{"FPGA boot from FLASH completed!"} << std::endl;
00239         \textcolor{keywordflow}{else}
00240             std::cout << \textcolor{stringliteral}{"FPGA boot from FLASH failed!"}<< GetLastErrorMessage() << std::endl;
00241     \}
00242     \textcolor{keywordflow}{else}
00243         std::cout << \textcolor{stringliteral}{"Programming failed! : "} << GetLastErrorMessage() << std::endl;
00244     ConnectionRegistry::freeConnection(conn);
00245     \textcolor{keywordflow}{return} (status==0)?EXIT\_SUCCESS:EXIT\_FAILURE;
00246 \}
00247 
00248 \textcolor{comment}{/***********************************************************************}
00249 \textcolor{comment}{ * Program gateware}
00250 \textcolor{comment}{ **********************************************************************/}
00251 \textcolor{keyword}{static} \textcolor{keywordtype}{int} programFirmware(\textcolor{keyword}{const} std::string &argStr)
00252 \{
00253     \textcolor{comment}{//load file}
00254     std::ifstream file;
00255     file.open(optarg, std::ios::in | std::ios::binary);
00256     \textcolor{keywordflow}{if}(not file.good())
00257     \{
00258         std::cout << \textcolor{stringliteral}{"File not found: "} << optarg << std::endl;
00259         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00260     \}
00261 
00262     std::streampos fileSize;
00263     file.seekg(0, std::ios::end);
00264     fileSize = file.tellg();
00265     file.seekg(0, std::ios::beg);
00266     std::vector<char> progData(fileSize, 0);
00267     file.read(progData.data(), fileSize);
00268 
00269     \textcolor{keyword}{auto} handles = ConnectionRegistry::findConnections(argStr);
00270     \textcolor{keywordflow}{if}(handles.size() == 0)
00271     \{
00272         std::cout << \textcolor{stringliteral}{"No devices found"} << std::endl;
00273         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00274     \}
00275     std::cout << \textcolor{stringliteral}{"Connected to ["} << handles[0].ToString() << \textcolor{stringliteral}{"]"} << std::endl;
00276     \textcolor{keyword}{auto} conn = ConnectionRegistry::makeConnection(handles[0]);
00277 
00278     \textcolor{keyword}{auto} progCallback = [](\textcolor{keywordtype}{int} bsent, \textcolor{keywordtype}{int} btotal, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* progressMsg)
00279     \{
00280         printf(\textcolor{stringliteral}{"[%3i%%] %5i/%5i Bytes %s\(\backslash\)r"}, \textcolor{keywordtype}{int}(100.0*bsent/btotal+0.5), bsent, btotal, progressMsg);
00281         fflush(stdout);
00282         \textcolor{keywordflow}{return} 0;
00283     \};
00284 
00285     \textcolor{keywordtype}{int} device = LMS64CProtocol::FX3; \textcolor{comment}{//FX3}
00286     \textcolor{keywordtype}{int} progMode = 2; \textcolor{comment}{//Firmware to FLASH}
00287     \textcolor{keyword}{auto} status = conn->ProgramWrite(progData.data(), progData.size(), progMode, 
      device, progCallback);
00288 
00289     std::cout << std::endl;
00290     \textcolor{keywordflow}{if}(status == 0)
00291     \{
00292         \textcolor{comment}{//Reset device}
00293         status = conn->ProgramWrite(\textcolor{keyword}{nullptr}, 0, 0, device, \textcolor{keyword}{nullptr});
00294         \textcolor{keywordflow}{if}(status == 0)
00295             std::cout << \textcolor{stringliteral}{"FX3 firmware uploaded, device has been reset"} << std::endl;
00296         \textcolor{keywordflow}{else}
00297             std::cout << \textcolor{stringliteral}{"FX3 firmware uploaded, failed to reset device"} << std::endl;
00298     \}
00299     \textcolor{keywordflow}{else}
00300         std::cout << \textcolor{stringliteral}{"Programming failed! : "} << GetLastErrorMessage() << std::endl;
00301     ConnectionRegistry::freeConnection(conn);
00302     \textcolor{keywordflow}{return} (status==0)?EXIT\_SUCCESS:EXIT\_FAILURE;
00303 \}
00304 
00305 \textcolor{comment}{/***********************************************************************}
00306 \textcolor{comment}{ * main entry point}
00307 \textcolor{comment}{ **********************************************************************/}
00308 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[])
00309 \{
00310     \textcolor{keyword}{static} \textcolor{keyword}{struct }option long\_options[] = \{
00311         \{\textcolor{stringliteral}{"help"}, no\_argument, 0, \textcolor{charliteral}{'h'}\},
00312         \{\textcolor{stringliteral}{"info"}, optional\_argument, 0, \textcolor{charliteral}{'i'}\},
00313         \{\textcolor{stringliteral}{"find"}, optional\_argument, 0, \textcolor{charliteral}{'f'}\},
00314         \{\textcolor{stringliteral}{"make"}, optional\_argument, 0, \textcolor{charliteral}{'m'}\},
00315         \{\textcolor{stringliteral}{"args"}, optional\_argument, 0, \textcolor{charliteral}{'a'}\},
00316         \{\textcolor{stringliteral}{"update"},     no\_argument, 0, \textcolor{charliteral}{'u'}\},
00317         \{\textcolor{stringliteral}{"fpga"}, required\_argument, 0, \textcolor{charliteral}{'g'}\},
00318         \{\textcolor{stringliteral}{"fw"},   required\_argument, 0, \textcolor{charliteral}{'w'}\},
00319         \{\textcolor{stringliteral}{"timing"},     no\_argument, 0, \textcolor{charliteral}{'t'}\},
00320         \{\textcolor{stringliteral}{"cal"},     optional\_argument, 0, \textcolor{charliteral}{'l'}\},
00321         \{\textcolor{stringliteral}{"start"},   required\_argument, 0, \textcolor{charliteral}{'s'}\},
00322         \{\textcolor{stringliteral}{"stop"},    required\_argument, 0, \textcolor{charliteral}{'p'}\},
00323         \{\textcolor{stringliteral}{"step"},    required\_argument, 0, \textcolor{charliteral}{'e'}\},
00324         \{\textcolor{stringliteral}{"bw"},      required\_argument, 0, \textcolor{charliteral}{'b'}\},
00325         \{\textcolor{stringliteral}{"dir"},     required\_argument, 0, \textcolor{charliteral}{'d'}\},
00326         \{\textcolor{stringliteral}{"chans"},   required\_argument, 0, \textcolor{charliteral}{'c'}\},
00327         \{0, 0, 0,  0\}
00328     \};
00329 
00330     std::string argStr, dir(\textcolor{stringliteral}{"BOTH"}), chans(\textcolor{stringliteral}{"ALL"});
00331     \textcolor{keywordtype}{double} start(0.0), stop(0.0), step(1e6), bw(30e6);
00332     \textcolor{keywordtype}{bool} testTiming(\textcolor{keyword}{false}), calSweep(\textcolor{keyword}{false});
00333     \textcolor{keywordtype}{int} long\_index = 0;
00334     \textcolor{keywordtype}{int} option = 0;
00335     \textcolor{keywordflow}{while} ((option = getopt\_long\_only(argc, argv, \textcolor{stringliteral}{""}, long\_options, &long\_index)) != -1)
00336     \{
00337         \textcolor{keywordflow}{switch} (option)
00338         \{
00339         \textcolor{keywordflow}{case} \textcolor{charliteral}{'h'}: \textcolor{keywordflow}{return} printHelp();
00340         \textcolor{keywordflow}{case} \textcolor{charliteral}{'i'}: \textcolor{keywordflow}{return} printInfo();
00341         \textcolor{keywordflow}{case} \textcolor{charliteral}{'f'}: \textcolor{keywordflow}{return} findDevices();
00342         \textcolor{keywordflow}{case} \textcolor{charliteral}{'m'}: \textcolor{keywordflow}{return} makeDevice();
00343         \textcolor{keywordflow}{case} \textcolor{charliteral}{'a'}:
00344             \textcolor{keywordflow}{if} (optarg != NULL) argStr = optarg;
00345             \textcolor{keywordflow}{break};
00346         \textcolor{keywordflow}{case} \textcolor{charliteral}{'u'}: \textcolor{keywordflow}{return} programUpdate(argStr);
00347         \textcolor{keywordflow}{case} \textcolor{charliteral}{'g'}: \textcolor{keywordflow}{return} programGateware(argStr);
00348         \textcolor{keywordflow}{case} \textcolor{charliteral}{'w'}: \textcolor{keywordflow}{return} programFirmware(argStr);
00349         \textcolor{keywordflow}{case} \textcolor{charliteral}{'t'}: testTiming = \textcolor{keyword}{true}; \textcolor{keywordflow}{break};
00350         \textcolor{keywordflow}{case} \textcolor{charliteral}{'l'}:
00351             calSweep = \textcolor{keyword}{true};
00352             \textcolor{keywordflow}{if} (optarg != NULL) argStr = optarg;
00353             \textcolor{keywordflow}{break};
00354         \textcolor{keywordflow}{case} \textcolor{charliteral}{'s'}: \textcolor{keywordflow}{if} (optarg != NULL) start = std::stod(optarg); \textcolor{keywordflow}{break};
00355         \textcolor{keywordflow}{case} \textcolor{charliteral}{'p'}: \textcolor{keywordflow}{if} (optarg != NULL) stop = std::stod(optarg); \textcolor{keywordflow}{break};
00356         \textcolor{keywordflow}{case} \textcolor{charliteral}{'e'}: \textcolor{keywordflow}{if} (optarg != NULL) step = std::stod(optarg); \textcolor{keywordflow}{break};
00357         \textcolor{keywordflow}{case} \textcolor{charliteral}{'b'}: \textcolor{keywordflow}{if} (optarg != NULL) bw = std::stod(optarg); \textcolor{keywordflow}{break};
00358         \textcolor{keywordflow}{case} \textcolor{charliteral}{'d'}: \textcolor{keywordflow}{if} (optarg != NULL) dir = optarg; \textcolor{keywordflow}{break};
00359         \textcolor{keywordflow}{case} \textcolor{charliteral}{'c'}: \textcolor{keywordflow}{if} (optarg != NULL) chans = optarg; \textcolor{keywordflow}{break};
00360         \}
00361     \}
00362 
00363     \textcolor{keywordflow}{if} (testTiming) \textcolor{keywordflow}{return} deviceTestTiming(argStr);
00364     \textcolor{keywordflow}{if} (calSweep) \textcolor{keywordflow}{return} deviceCalSweep(argStr, start, stop, step, bw, dir, chans);
00365 
00366     \textcolor{comment}{//unknown or unspecified options, do help...}
00367     \textcolor{keywordflow}{return} printHelp();
00368 \}
\end{DoxyCode}
