\subsection{qa\+\_\+estimator\+\_\+rcs.\+py}
\label{qa__estimator__rcs_8py_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+estimator\+\_\+rcs.\+py@{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+estimator\+\_\+rcs.\+py}}

\begin{DoxyCode}
00001 \textcolor{comment}{#!/usr/bin/env python}
00002 \textcolor{comment}{# -*- coding: utf-8 -*-}
00003 \textcolor{comment}{# }
00004 \textcolor{comment}{# Copyright 2014 Communications Engineering Lab, KIT.}
00005 \textcolor{comment}{# }
00006 \textcolor{comment}{# This is free software; you can redistribute it and/or modify}
00007 \textcolor{comment}{# it under the terms of the GNU General Public License as published by}
00008 \textcolor{comment}{# the Free Software Foundation; either version 3, or (at your option)}
00009 \textcolor{comment}{# any later version.}
00010 \textcolor{comment}{# }
00011 \textcolor{comment}{# This software is distributed in the hope that it will be useful,}
00012 \textcolor{comment}{# but WITHOUT ANY WARRANTY; without even the implied warranty of}
00013 \textcolor{comment}{# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00014 \textcolor{comment}{# GNU General Public License for more details.}
00015 \textcolor{comment}{# }
00016 \textcolor{comment}{# You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{# along with this software; see the file COPYING.  If not, write to}
00018 \textcolor{comment}{# the Free Software Foundation, Inc., 51 Franklin Street,}
00019 \textcolor{comment}{# Boston, MA 02110-1301, USA.}
00020 \textcolor{comment}{# }
00021 
00022 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} gr, gr\_unittest
00023 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} blocks
00024 \textcolor{keyword}{import} radar\_swig \textcolor{keyword}{as} radar
00025 \textcolor{keyword}{import} pmt
00026 \textcolor{keyword}{from} time \textcolor{keyword}{import} sleep
00027 \textcolor{keyword}{import} math
00028 
00029 \textcolor{keyword}{class }qa_estimator_rcs (gr\_unittest.TestCase):
00030 
00031     \textcolor{keyword}{def }setUp (self):
00032         self.tb = gr.top\_block ()
00033 
00034     \textcolor{keyword}{def }tearDown (self):
00035         self.tb = \textcolor{keywordtype}{None}
00036 
00037     \textcolor{keyword}{def }test_001_t (self):
00038         \textcolor{comment}{# set up fg}
00039         num\_mean = 1
00040         center\_freq = 1
00041         antenna\_gain\_tx = 1
00042         antenna\_gain\_rx = 1
00043         usrp\_gain\_rx = 1
00044         amplitude = 1
00045         corr\_factor = 1
00046         exponent = 1
00047 
00048         Range = (10, 20, 30)
00049         power = (15, 30, 45)
00050 
00051         pmt\_range = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{'range'}),pmt.init\_f32vector(
      len(Range),Range))
00052         pmt\_power = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{'power'}),pmt.init\_f32vector(
      len(power),power))
00053         pmt\_misc = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{'misc'}),pmt.init\_f32vector(3,(1,2,3)))
00054         pmt\_in = pmt.list3(pmt\_misc,pmt\_range,pmt\_power)
00055 
00056         src = blocks.message\_strobe(pmt\_in, 300)
00057         est = radar.estimator\_rcs(num\_mean, center\_freq, antenna\_gain\_tx, antenna\_gain\_rx, usrp\_gain\_rx, 
      amplitude, corr\_factor, exponent)
00058         snk = blocks.message\_debug()
00059         self.tb.msg\_connect(src,\textcolor{stringliteral}{"strobe"},est,\textcolor{stringliteral}{"Msg in"})
00060         self.tb.msg\_connect(est,\textcolor{stringliteral}{"Msg out"},snk,\textcolor{stringliteral}{"store"})
00061         self.tb.msg\_connect(est,\textcolor{stringliteral}{"Msg out"},snk,\textcolor{stringliteral}{"print"})
00062         
00063         self.tb.start()
00064         sleep(0.5)
00065         self.tb.stop()
00066         self.tb.wait()
00067 
00068         \textcolor{comment}{# check data}
00069 
00070         msg = snk.get\_message(0)
00071 
00072         wavel = 3e8/center\_freq
00073         d\_antenna\_gain\_abs\_rx = 10**(antenna\_gain\_rx/10)
00074         d\_antenna\_gain\_abs\_tx = 10**(antenna\_gain\_tx/10)
00075         power\_rx = power[0]**exponent / 10**(usrp\_gain\_rx/10);
00076         power\_tx = amplitude
00077 
00078         rcs\_ref = (4*math.pi)**(3)/(d\_antenna\_gain\_abs\_rx*d\_antenna\_gain\_abs\_tx*wavel**2)*Range[0]**4*
      power\_rx/power\_tx*corr\_factor
00079 
00080         self.assertAlmostEqual( rcs\_ref, pmt.f32vector\_ref(pmt.nth(1,(pmt.nth(0,msg))),0), 4 ) \textcolor{comment}{# check rcs
       value}
00081 
00082 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:
00083     gr\_unittest.run(qa\_estimator\_rcs)\textcolor{comment}{#, "qa\_estimator\_rcs.xml")}
\end{DoxyCode}
