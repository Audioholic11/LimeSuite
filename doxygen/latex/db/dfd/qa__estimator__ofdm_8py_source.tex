\subsection{qa\+\_\+estimator\+\_\+ofdm.\+py}
\label{qa__estimator__ofdm_8py_source}\index{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+estimator\+\_\+ofdm.\+py@{/home/erik/prefix/default/src/gr-\/radar-\/dev/python/qa\+\_\+estimator\+\_\+ofdm.\+py}}

\begin{DoxyCode}
00001 \textcolor{comment}{#!/usr/bin/env python}
00002 \textcolor{comment}{# -*- coding: utf-8 -*-}
00003 \textcolor{comment}{# }
00004 \textcolor{comment}{# Copyright 2014 Communications Engineering Lab, KIT.}
00005 \textcolor{comment}{# }
00006 \textcolor{comment}{# This is free software; you can redistribute it and/or modify}
00007 \textcolor{comment}{# it under the terms of the GNU General Public License as published by}
00008 \textcolor{comment}{# the Free Software Foundation; either version 3, or (at your option)}
00009 \textcolor{comment}{# any later version.}
00010 \textcolor{comment}{# }
00011 \textcolor{comment}{# This software is distributed in the hope that it will be useful,}
00012 \textcolor{comment}{# but WITHOUT ANY WARRANTY; without even the implied warranty of}
00013 \textcolor{comment}{# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00014 \textcolor{comment}{# GNU General Public License for more details.}
00015 \textcolor{comment}{# }
00016 \textcolor{comment}{# You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{# along with this software; see the file COPYING.  If not, write to}
00018 \textcolor{comment}{# the Free Software Foundation, Inc., 51 Franklin Street,}
00019 \textcolor{comment}{# Boston, MA 02110-1301, USA.}
00020 \textcolor{comment}{# }
00021 
00022 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} gr, gr\_unittest
00023 \textcolor{keyword}{from} gnuradio \textcolor{keyword}{import} blocks
00024 \textcolor{keyword}{import} radar\_swig \textcolor{keyword}{as} radar
00025 \textcolor{keyword}{import} pmt
00026 \textcolor{keyword}{from} time \textcolor{keyword}{import} sleep
00027 
00028 \textcolor{keyword}{class }qa_estimator_ofdm (gr\_unittest.TestCase):
00029 
00030     \textcolor{keyword}{def }setUp (self):
00031         self.tb = gr.top\_block ()
00032 
00033     \textcolor{keyword}{def }tearDown (self):
00034         self.tb = \textcolor{keywordtype}{None}
00035 
00036     \textcolor{keyword}{def }test_001_t (self):
00037         \textcolor{comment}{# set up fg}
00038         Range = (2,4,22,23)
00039         velocity = (3,12,19,19)
00040         power = (10,10,10,1) \textcolor{comment}{# last value is thrown away with merging peaks}
00041         pmt\_time = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{'rx\_time'}),pmt.make\_tuple(pmt.from\_long(-1),
      pmt.from\_double(0)))
00042         pmt\_axisx = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{'axis\_x'}),pmt.init\_f32vector(
      len(Range),Range))
00043         pmt\_axisy = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{'axis\_y'}),pmt.init\_f32vector(
      len(velocity),velocity))
00044         pmt\_power = pmt.list2(pmt.string\_to\_symbol(\textcolor{stringliteral}{'power'}),pmt.init\_f32vector(
      len(power),power))
00045         pmt\_in = pmt.list4(pmt\_time, pmt\_axisx, pmt\_axisy, pmt\_power)
00046         
00047         src = blocks.message\_strobe(pmt\_in, 300)
00048         est = radar.estimator\_ofdm(\textcolor{stringliteral}{'range'},30,(0,40,-40,10),\textcolor{stringliteral}{'velocity'},20,(-5,5))
00049         snk = blocks.message\_debug()
00050         self.tb.msg\_connect(src,\textcolor{stringliteral}{"strobe"},est,\textcolor{stringliteral}{"Msg in"})
00051         self.tb.msg\_connect(est,\textcolor{stringliteral}{"Msg out"},snk,\textcolor{stringliteral}{"store"})
00052         self.tb.msg\_connect(est,\textcolor{stringliteral}{"Msg out"},snk,\textcolor{stringliteral}{"print"})
00053         
00054         self.tb.start()
00055         sleep(0.5)
00056         self.tb.stop()
00057         self.tb.wait()
00058         
00059         \textcolor{comment}{# get ref data}
00060         ref\_range = (0+40*2/15.0, 0+40*4/15.0, -40+50*(22-15)/15.0)
00061         ref\_velocity = (-5+10*3/20.0, -5+10*12/20.0, -5+10*19/20.0)
00062         
00063         \textcolor{comment}{# check data}
00064         msg = snk.get\_message(0)
00065         val\_range = pmt.f32vector\_elements(pmt.nth(1,pmt.nth(1,msg)))
00066         val\_velocity = pmt.f32vector\_elements(pmt.nth(1,pmt.nth(2,msg)))
00067         \textcolor{keywordflow}{print} val\_range
00068         self.assertFloatTuplesAlmostEqual(val\_velocity,ref\_velocity,4)
00069         self.assertFloatTuplesAlmostEqual(val\_range,ref\_range,4)
00070 
00071 
00072 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:
00073     gr\_unittest.run(qa\_estimator\_ofdm)\textcolor{comment}{#, "qa\_estimator\_ofdm.xml")}
\end{DoxyCode}
